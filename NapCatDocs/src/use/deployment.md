# MaiCore Start éƒ¨ç½²æ•™ç¨‹

> **æ¬¢è¿ä½¿ç”¨ MaiCore Startï¼** è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ï¼ˆæˆ‘çŒœæ˜¯çš„ï¼‰ Bot å®ä¾‹éƒ¨ç½²ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒ MaiBot å’Œ MoFox_bot çš„å®Œæ•´è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ã€‚

::: tip æ¸©é¦¨æç¤º
æœ¬æ•™ç¨‹ä¸“ä¸ºæ–°æ‰‹è®¾è®¡ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æœ‰è¯¦ç»†è¯´æ˜ã€‚å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œè¯·ä»”ç»†é˜…è¯»å¯¹åº”çš„è§£å†³æ–¹æ¡ˆéƒ¨åˆ†ã€‚
:::

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [éƒ¨ç½²æ¶æ„è®¾è®¡](#éƒ¨ç½²æ¶æ„è®¾è®¡)
- [è¯¦ç»†éƒ¨ç½²æµç¨‹](#è¯¦ç»†éƒ¨ç½²æµç¨‹)
- [MaiBot éƒ¨ç½²æŒ‡å—](#maibot-éƒ¨ç½²æŒ‡å—)
- [MoFox_bot éƒ¨ç½²æŒ‡å—](#mofox_bot-éƒ¨ç½²æŒ‡å—)
- [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#æ ¸å¿ƒç»„ä»¶è¯¦è§£)
- [é…ç½®æ–‡ä»¶è¯´æ˜](#é…ç½®æ–‡ä»¶è¯´æ˜)
- [å¸¸è§é—®é¢˜è§£å†³](#å¸¸è§é—®é¢˜è§£å†³)
- [é«˜çº§é…ç½®](#é«˜çº§é…ç½®)

---

## ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚

::: info ç³»ç»Ÿè¦æ±‚
åœ¨å¼€å§‹éƒ¨ç½²ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š
:::

### åŸºç¡€è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10/11 (64ä½)
- **å†…å­˜**: è‡³å°‘ 4GB RAM (æ¨è 8GB æˆ–æ›´å¤š)
- **å­˜å‚¨ç©ºé—´**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

### è½¯ä»¶ä¾èµ–

- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ (ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹)
- **Git**: ç”¨äºä¸‹è½½æºç  (å¯é€‰ï¼Œç³»ç»Ÿä¼šå¤„ç†)
- **Node.js**: ä»…åœ¨å®‰è£… WebUI æ—¶éœ€è¦ (ç³»ç»Ÿä¼šè‡ªåŠ¨å®‰è£…)

::: warning é‡è¦æé†’
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼Œéƒ¨ç½²è¿‡ç¨‹ä¼šä¸‹è½½å¤šä¸ªç»„ä»¶
- ç½‘ç»œè¿æ¥å¿…é¡»ç¨³å®šï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ä¸‹è½½å¤±è´¥
- å»ºè®®å…³é—­æ€æ¯’è½¯ä»¶çš„å®æ—¶ä¿æŠ¤ï¼Œé¿å…è¯¯åˆ æ–‡ä»¶
:::


## ğŸš€ å¿«é€Ÿå¼€å§‹

> æ¥è‡ªå®˜æ–¹çš„éƒ¨ç½²æŒ‡å—

<NCard title="ğŸ“¦ MaiBot å®˜æ–¹éƒ¨ç½²æ–‡æ¡£" link="https://docs.mai-mai.org/manual/deployment/">
éº¦éº¦å®˜æ–¹éƒ¨ç½²æŒ‡å—ï¼Œå¤šç³»ç»Ÿé€‚é…
</NCard>

<NCard title="ğŸ“¦ MoFox_bot å®˜æ–¹éƒ¨ç½²æ–‡æ¡£" link="https://docs.mofox-sama.com/docs/guides/">
å¢¨ç‹å®˜æ–¹éƒ¨ç½²æŒ‡å—ï¼Œå¤šç³»ç»Ÿé€‚é…
</NCard>

### å¿«é€Ÿéƒ¨ç½²æµç¨‹

#### ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨éƒ¨ç½²ç¨‹åº

1. åŒå‡»è¿è¡Œ `MaiCoreStart.exe`
2. ç­‰å¾…ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
3. åœ¨ä¸»èœå•ä¸­é€‰æ‹© **[1] éƒ¨ç½²æ–°å®ä¾‹**

#### ç¬¬äºŒæ­¥ï¼šé€‰æ‹© Bot ç±»å‹

```bash
ğŸ¤– Botç±»å‹é€‰æ‹©
è¯·é€‰æ‹©è¦éƒ¨ç½²çš„Botç±»å‹ï¼š
 [1] MaiBot (é»˜è®¤)
 [2] MoFox_bot
```

- **æ–°æ‰‹æ¨è**: é€‰æ‹© `1` (MaiBot)ï¼Œç”Ÿæ€å®Œå–„
- **é«˜çº§ç”¨æˆ·**: é€‰æ‹© `2` (MoFox_bot)ï¼Œæ€§èƒ½ä¼˜å¼‚

#### ç¬¬ä¸‰æ­¥ï¼šç‰ˆæœ¬é€‰æ‹©

ç³»ç»Ÿé€šè¿‡ GitHub API è‡ªåŠ¨è·å–æœ€æ–°ç‰ˆæœ¬ï¼š

- **ç¨³å®šç‰ˆæœ¬**: æ¨èé€‰æ‹©æœ€æ–°çš„ release ç‰ˆæœ¬
- **å¼€å‘ç‰ˆæœ¬**: `main` åˆ†æ”¯ï¼ˆæœ€æ–°åŠŸèƒ½ï¼Œå¯èƒ½ä¸ç¨³å®šï¼‰

#### ç¬¬å››æ­¥ï¼šç»„ä»¶é€‰æ‹©

æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©å®‰è£…ç»„ä»¶ï¼š

- **é€‚é…å™¨**: å¿…è£…ï¼ˆè¿æ¥ QQ åè®®ç«¯ï¼‰
- **NapCat**: å¿…è£…ï¼ˆQQ åè®®å®ç°ï¼‰
- **MongoDB**: å¯é€‰ï¼ˆæ ¹æ® Bot ç‰ˆæœ¬å†³å®šï¼‰
- **WebUI**: æ¨èï¼ˆç½‘é¡µç®¡ç†ç•Œé¢ï¼‰

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    A[MaiCore Start éƒ¨ç½²ç³»ç»Ÿ] --> B[DeploymentManager]
    B --> C[MaiBotDeployer]
    B --> D[MoFoxBotDeployer]
    B --> E[NapCatDeployer]
    
    C --> F[VersionManager]
    C --> G[BaseDeployer]
    D --> H[VersionManager]
    D --> G
    
    G --> I[ç½‘ç»œæ£€æŸ¥]
    G --> J[æ–‡ä»¶ä¸‹è½½]
    G --> K[ç¯å¢ƒé…ç½®]
    G --> L[ä¾èµ–å®‰è£…]
    
    I --> M[GitHub API]
    J --> N[PyPIé•œåƒ]
    K --> O[è™šæ‹Ÿç¯å¢ƒ]
    L --> P[requirements.txt]
```

### æ ¸å¿ƒè®¾è®¡æ¨¡å¼

MaiCore Start é‡‡ç”¨<mark>æ¨¡å—åŒ–éƒ¨ç½²æ¶æ„</mark>ï¼Œé€šè¿‡ç­–ç•¥æ¨¡å¼å®ç°ä¸åŒ Bot ç±»å‹çš„å·®å¼‚åŒ–éƒ¨ç½²ï¼š

```python
# éƒ¨ç½²ç®¡ç†å™¨æ ¸å¿ƒå®ç°
class DeploymentManager:
    """éƒ¨ç½²ç®¡ç†å™¨ - åè°ƒå„ä¸ªéƒ¨ç½²å™¨å®Œæˆéƒ¨ç½²ä»»åŠ¡"""
    
    def __init__(self):
        # åˆå§‹åŒ–å„ä¸ªéƒ¨ç½²å™¨
        self.maibot_deployer = MaiBotDeployer()
        self.mofox_deployer = MoFoxBotDeployer()
        self.napcat_deployer = NapCatDeployer()
        
        # ç¦»çº¿æ¨¡å¼æ ‡å¿—
        self._offline_mode = False
    
    def deploy_instance(self) -> bool:
        """éƒ¨ç½²æ–°å®ä¾‹ - é‡æ„ç‰ˆæœ¬"""
        # ç½‘ç»œæ£€æŸ¥
        if not self._check_network_for_deployment():
            return False
        
        # è·å–éƒ¨ç½²é…ç½®
        deploy_config = self._get_deployment_config()
        if not deploy_config:
            return False
        
        # ç¡®è®¤é…ç½®
        if not self._confirm_deployment(deploy_config):
            return False
        
        # æ‰§è¡Œéƒ¨ç½²æµç¨‹
        paths = self._run_deployment_steps(deploy_config)
        
        # å®Œæˆéƒ¨ç½²
        return self._finalize_deployment(deploy_config, **paths)
```

## ğŸ“– è¯¦ç»†éƒ¨ç½²æµç¨‹

### éƒ¨ç½²æµç¨‹å›¾

::: details ç‚¹å‡»å±•å¼€è¯¦ç»†æµç¨‹

```mermaid
graph TD
    A[å¯åŠ¨éƒ¨ç½²ç¨‹åº] --> B[ç½‘ç»œè¿æ¥æ£€æŸ¥]
    B --> C[Botç±»å‹é€‰æ‹©]
    C --> D[ç‰ˆæœ¬ç®¡ç†å™¨è·å–]
    D --> E[ç‰ˆæœ¬é€‰æ‹©ç•Œé¢]
    E --> F[ç»„ä»¶å®‰è£…é€‰é¡¹]
    F --> G[å®‰è£…è·¯å¾„é…ç½®]
    G --> H[å®ä¾‹å‘½å]
    H --> I[åºåˆ—å·ç”Ÿæˆ]
    I --> J[é…ç½®ç¡®è®¤]
    J --> K[å¼€å§‹éƒ¨ç½²æµç¨‹]
    
    K --> L[Botä¸»ä½“å®‰è£…]
    L --> M[é€‚é…å™¨å®‰è£…]
    M --> N[NapCatå®‰è£…]
    N --> O[WebUIå®‰è£…]
    O --> P[Pythonç¯å¢ƒè®¾ç½®]
    P --> Q[ä¾èµ–åŒ…å®‰è£…]
    Q --> R[é…ç½®æ–‡ä»¶ç”Ÿæˆ]
    R --> S[å®ä¾‹é…ç½®ä¿å­˜]
    S --> T[éƒ¨ç½²å®Œæˆ]
```
:::

### æ ¸å¿ƒæ­¥éª¤è¯¦è§£

#### 1. ç½‘ç»œè¿æ¥æ£€æŸ¥ ğŸ”

ç³»ç»Ÿé€šè¿‡å¤šendpointæ£€æµ‹ç½‘ç»œçŠ¶æ€ï¼š

```python
def check_network_connection(self) -> Tuple[bool, str]:
    """æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€"""
    endpoints = [
        ("https://api.github.com", "GitHub API"),
        ("https://github.com", "GitHub"),
        ("https://pypi.tuna.tsinghua.edu.cn", "æ¸…åPyPIé•œåƒ")
    ]
    
    for url, name in endpoints:
        try:
            response = requests.get(url, timeout=5)
            if response.status_code in [200, 301, 302]:
                return True, ""
        except Exception:
            continue
    
    return False, "æ— æ³•è¿æ¥åˆ°GitHubå’ŒPyPIé•œåƒç«™ç‚¹"
```

- **âœ… ç½‘ç»œæ­£å¸¸**: è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
- **âŒ ç½‘ç»œå¼‚å¸¸**: å¯ç”¨ç¦»çº¿æ¨¡å¼ï¼Œä½¿ç”¨ç¼“å­˜ç‰ˆæœ¬

::: warning ç½‘ç»œé—®é¢˜å¤„ç†
å¦‚æœç½‘ç»œæ£€æŸ¥å¤±è´¥ï¼Œç³»ç»Ÿæä¾›ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š
1. **ç­‰å¾…é‡è¯•**: GitHub API é€Ÿç‡é™åˆ¶é€šå¸¸åœ¨ 10 ç§’å†…æ¢å¤
2. **ç½‘ç»œè¯Šæ–­**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
3. **ä»£ç†é…ç½®**: é…ç½®ä¼ä¸šä»£ç†æˆ–ä½¿ç”¨æ‰‹æœºçƒ­ç‚¹
4. **ç¦»çº¿æ¨¡å¼**: ä½¿ç”¨æœ¬åœ°ç¼“å­˜ç»§ç»­éƒ¨ç½²
:::

#### 2. Bot ç±»å‹é€‰æ‹© ğŸ¤–

**MaiBot æ¶æ„ç‰¹ç‚¹**:
- **æˆç†Ÿç”Ÿæ€**: ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€å’Œç¤¾åŒºæ”¯æŒ
- **ç‰ˆæœ¬å…¼å®¹**: æ”¯æŒä» classical åˆ°æœ€æ–°ç‰ˆæœ¬çš„å¹³æ»‘å‡çº§
- **é…ç½®çµæ´»**: é€‚é…ä¸åŒç‰ˆæœ¬éœ€æ±‚çš„ç»„ä»¶é…ç½®

**MoFox_bot æ¶æ„ç‰¹ç‚¹**:
- **é«˜æ€§èƒ½è®¾è®¡**: å†…ç½®é€‚é…å™¨ï¼Œå‡å°‘å¤–éƒ¨ä¾èµ–
- **æ¨¡å—åŒ–æ¶æ„**: æ’ä»¶åŒ–è®¾è®¡ï¼ŒåŠŸèƒ½æ‰©å±•æ€§å¼º
- **éƒ¨ç½²ç®€åŒ–**: ä¸€ä½“åŒ–éƒ¨ç½²æµç¨‹

#### 3. ç‰ˆæœ¬é€‰æ‹©ç³»ç»Ÿ ğŸ“¦

ç‰ˆæœ¬ç®¡ç†é€šè¿‡ `VersionManager` å®ç°æ™ºèƒ½ç‰ˆæœ¬æ§åˆ¶ï¼š

```python
class VersionManager:
    """ç‰ˆæœ¬ç®¡ç†å™¨ - è´Ÿè´£è·å–å’Œç®¡ç†Botç‰ˆæœ¬ä¿¡æ¯"""
    
    def get_versions(self, force_refresh: bool = False) -> List[Dict]:
        """è·å–ç‰ˆæœ¬åˆ—è¡¨ï¼ˆåŒ…æ‹¬releaseså’Œåˆ†æ”¯ï¼‰"""
        if not force_refresh and self._is_cache_valid():
            return self._versions_cache
        
        versions = []
        
        # è·å–releases
        releases = self.get_github_releases(include_prerelease=True)
        for release in releases:
            version_info = {
                "name": release.get("tag_name", ""),
                "display_name": release.get("name", release.get("tag_name", "")),
                "type": "release",
                "download_url": f"https://codeload.github.com/{self.repo}/zip/refs/tags/{release.get('tag_name', '')}",
                "changelog": release.get("body", "æš‚æ— æ›´æ–°æ—¥å¿—")
            }
            versions.append(version_info)
        
        # è·å–åˆ†æ”¯
        branches = self.get_github_branches()
        for branch in branches:
            if branch.get("name") in self.supported_branches:
                version_info = {
                    "name": branch.get("name", ""),
                    "display_name": f"{branch.get('name', '')}åˆ†æ”¯",
                    "type": "branch",
                    "download_url": f"https://codeload.github.com/{self.repo}/zip/refs/heads/{branch.get('name', '')}",
                    "changelog": "åˆ†æ”¯æ— å›ºå®šæ›´æ–°æ—¥å¿—"
                }
                versions.append(version_info)
        
        return self._prioritize_versions(versions)
```

**ç‰ˆæœ¬ç±»å‹è¯´æ˜**:
- **Release ç‰ˆæœ¬**: ç»è¿‡å……åˆ†æµ‹è¯•çš„ç¨³å®šç‰ˆæœ¬
- **Main åˆ†æ”¯**: æœ€æ–°å¼€å‘ç‰ˆæœ¬ï¼ŒåŒ…å«æœ€æ–°åŠŸèƒ½
- **Dev åˆ†æ”¯**: å¼€å‘ç‰ˆæœ¬ï¼ŒåŒ…å«å®éªŒæ€§åŠŸèƒ½

#### 4. æ™ºèƒ½ç»„ä»¶é€‰æ‹© ğŸ”§

ç³»ç»Ÿæ ¹æ® Bot ç±»å‹å’Œç‰ˆæœ¬è‡ªåŠ¨åˆ¤æ–­ç»„ä»¶éœ€æ±‚ï¼š

```python
def get_version_requirements(version: str) -> Dict[str, Any]:
    """æ ¹æ®ç‰ˆæœ¬è·å–å®Œæ•´çš„éœ€æ±‚é…ç½®"""
    return {
        "is_legacy": is_legacy_version(version),
        "needs_mongodb": needs_mongodb(version),
        "needs_adapter": needs_adapter(version),
        "adapter_version": get_adapter_version(version),
        "parsed_version": parse_version(version)
    }

def is_legacy_version(version: str) -> bool:
    """æ£€æµ‹æ˜¯å¦ä¸ºæ—§ç‰ˆæœ¬ï¼ˆå°äº0.6.0æˆ–ä¸ºclassicalï¼‰"""
    if version == "classical":
        return True
    
    try:
        version_parts = version.split('.')
        if len(version_parts) >= 2:
            major = int(version_parts[0])
            minor = int(version_parts[1])
            return major < 0 or (major == 0 and minor < 6)
    except (ValueError, IndexError):
        return False
    
    return False
```

**ç»„ä»¶é€‰æ‹©ç­–ç•¥**:
- **é€‚é…å™¨**: æ ¹æ®ç‰ˆæœ¬è‡ªåŠ¨é€‰æ‹©å…¼å®¹ç‰ˆæœ¬
  - 0.6.x â†’ 0.2.3
  - 0.7.x-0.8.x â†’ 0.4.2
  - 0.9.x+ â†’ main åˆ†æ”¯
- **NapCat**: æä¾›å¤šç§ç‰ˆæœ¬é€‰æ‹©ï¼ˆShell/Framework/OneKeyï¼‰
- **MongoDB**: æ—§ç‰ˆæœ¬éœ€è¦ï¼Œæ–°ç‰ˆæœ¬å¯é€‰
- **WebUI**: æ ¹æ® Bot ç±»å‹æä¾›ä¸åŒç•Œé¢

---

## ğŸ¤– MaiBot éƒ¨ç½²æŒ‡å—

### MaiBot ç®€ä»‹

MaiBot æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”ç¨³å®šçš„ QQ æœºå™¨äººæ¡†æ¶ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€å’Œå®Œå–„çš„æ–‡æ¡£æ”¯æŒã€‚

### éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1: é€‰æ‹© MaiBot

åœ¨ Bot ç±»å‹é€‰æ‹©æ—¶è¾“å…¥ `1` æˆ–ç›´æ¥å›è½¦ï¼ˆé»˜è®¤ï¼‰

#### æ­¥éª¤ 2: ç‰ˆæœ¬é€‰æ‹©

MaiBot ç‰ˆæœ¬é€‰æ‹©ç•Œé¢ï¼š

```
ğŸš€ é€‰æ‹©éƒ¨ç½²ç‰ˆæœ¬ - MaiBot
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚é€‰é¡¹ â”‚ ç‰ˆæœ¬              â”‚ ç±»å‹   â”‚ è¯´æ˜                               â”‚ å‘å¸ƒæ—¶é—´   â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [1] â”‚ v0.11.6          â”‚ å‘è¡Œç‰ˆ â”‚ æœ€æ–°ç¨³å®šç‰ˆæœ¬                        â”‚ 2024-12-01 â”‚
â”‚ [2] â”‚ mainåˆ†æ”¯         â”‚ åˆ†æ”¯   â”‚ æœ€æ–°å¼€å‘ç‰ˆæœ¬                        â”‚ -          â”‚
â”‚ [3] â”‚ v0.9.8           â”‚ å‘è¡Œç‰ˆ â”‚ ç¨³å®šç‰ˆæœ¬                            â”‚ 2024-11-15 â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[C] æŸ¥çœ‹ç‰ˆæœ¬æ›´æ–°æ—¥å¿—  [R] åˆ·æ–°ç‰ˆæœ¬åˆ—è¡¨  [Q] è¿”å›ä¸Šçº§èœå•
```

**æ¨èé€‰æ‹©**:
- **æ–°æ‰‹**: `v0.11.6` (æœ€æ–°ç¨³å®šç‰ˆ)
- **å¼€å‘è€…**: `mainåˆ†æ”¯` (æœ€æ–°åŠŸèƒ½)

#### æ­¥éª¤ 3: é€‚é…å™¨å®‰è£…

ç³»ç»Ÿä¼šæ ¹æ®ç‰ˆæœ¬è‡ªåŠ¨é€‰æ‹©é€‚é…å™¨ï¼š

- **0.5.x åŠä»¥ä¸‹**: æ— éœ€é€‚é…å™¨
- **0.6.x**: ä½¿ç”¨ 0.2.3 ç‰ˆæœ¬é€‚é…å™¨
- **0.7.x-0.8.x**: ä½¿ç”¨ 0.4.2 ç‰ˆæœ¬é€‚é…å™¨
- **main/dev åˆ†æ”¯**: ä½¿ç”¨å¯¹åº”åˆ†æ”¯é€‚é…å™¨

#### æ­¥éª¤ 4: é…ç½®æ–‡ä»¶

MaiBot >= 0.10.0 ç‰ˆæœ¬ä¼šåˆ›å»ºä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š

- `config/bot_config.toml`: æœºå™¨äººåŸºæœ¬é…ç½®
- `config/model_config.toml`: æ¨¡å‹é…ç½®ï¼ˆAPI å¯†é’¥ç­‰ï¼‰
- `.env`: ç¯å¢ƒå˜é‡é…ç½®

æ—§ç‰ˆæœ¬å¯èƒ½è¿˜ä¼šåŒ…å«ï¼š
- `config/lpmm_config.toml`: LPMM çŸ¥è¯†åº“é…ç½®

### MaiBot ç›®å½•ç»“æ„

```
instances/
â””â”€â”€ [å®ä¾‹åç§°]/
    â”œâ”€â”€ MaiBot/                 # MaiBot ä¸»ç¨‹åº
    â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶ç›®å½•
    â”‚   â”œâ”€â”€ data/               # æ•°æ®ç›®å½•
    â”‚   â”œâ”€â”€ template/           # é…ç½®æ¨¡æ¿
    â”‚   â””â”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
    â”œâ”€â”€ MaiBot-Napcat-Adapter/  # é€‚é…å™¨ï¼ˆå¦‚æœå®‰è£…ï¼‰
    â””â”€â”€ venv/                   # Python è™šæ‹Ÿç¯å¢ƒ
```

## ğŸ¦Š MoFox_bot éƒ¨ç½²æŒ‡å—

### MoFox_bot ç®€ä»‹

MoFox_bot æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ QQ æœºå™¨äººæ¡†æ¶ï¼Œå…·æœ‰å†…ç½®é€‚é…å™¨å’Œå¼ºå¤§çš„åŠŸèƒ½ç‰¹æ€§ã€‚

### éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1: é€‰æ‹© MoFox_bot

åœ¨ Bot ç±»å‹é€‰æ‹©æ—¶è¾“å…¥ `2`

#### æ­¥éª¤ 2: ç‰ˆæœ¬é€‰æ‹©

MoFox_bot ç‰ˆæœ¬é€‰æ‹©ç•Œé¢ç±»ä¼¼ï¼Œä½†ä»“åº“ä¸åŒ

**æ¨èé€‰æ‹©**:
- **æ–°æ‰‹**: é€‰æ‹©æœ€æ–°çš„ Release ç‰ˆæœ¬
- **å¼€å‘è€…**: é€‰æ‹© main åˆ†æ”¯

#### æ­¥éª¤ 3: é€‚é…å™¨è¯´æ˜

**é‡è¦**: MoFox_bot å†…ç½®é€‚é…å™¨ï¼Œé€šå¸¸æ— éœ€å®‰è£…å¤–ç½®é€‚é…å™¨ã€‚

å¦‚æœé€‰æ‹©å®‰è£…å¤–ç½®é€‚é…å™¨ï¼Œç³»ç»Ÿä¼šæç¤ºï¼š

```
â„¹ï¸ å¤–ç½®é€‚é…å™¨æé†’
å¢¨ç‹å·²ç»å°†é€‚é…å™¨ä½œä¸ºæ’ä»¶å†…ç½®åœ¨ä¸»ç¨‹åºä¸­ã€‚
å¦‚éœ€è·å–å¤–ç½®é€‚é…å™¨ï¼Œè¯·è®¿é—®ï¼š
https://github.com/MoFox-Studio/NapCat-Adapter
```

#### æ­¥éª¤ 4: é…ç½®æ–‡ä»¶

MoFox_bot ä¼šåˆ›å»ºä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š

- `config/bot_config.toml`: æœºå™¨äººåŸºæœ¬é…ç½®
- `config/model_config.toml`: æ¨¡å‹é…ç½®
- `.env`: ç¯å¢ƒå˜é‡é…ç½®

### MoFox_bot ç›®å½•ç»“æ„

```
instances/
â””â”€â”€ [å®ä¾‹åç§°]/
    â”œâ”€â”€ MoFox_bot/              # MoFox_bot ä¸»ç¨‹åº
    â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶ç›®å½•
    â”‚   â”œâ”€â”€ data/               # æ•°æ®ç›®å½•
    â”‚   â”œâ”€â”€ template/           # é…ç½®æ¨¡æ¿
    â”‚   â””â”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
    â””â”€â”€ venv/                   # Python è™šæ‹Ÿç¯å¢ƒ
```


## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### NapCat éƒ¨ç½²å™¨

NapCat æ˜¯ QQ åè®®ç«¯çš„æ ¸å¿ƒå®ç°ï¼Œè´Ÿè´£ä¸è…¾è®¯æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚

#### ç‰ˆæœ¬ç±»å‹ä¸é€‰æ‹©ç­–ç•¥

```python
class NapCatDeployer(BaseDeployer):
    """NapCatéƒ¨ç½²å™¨ - è´Ÿè´£NapCatçš„ä¸‹è½½ã€å®‰è£…å’Œé…ç½®"""
    
    def get_napcat_versions(self, force_refresh: bool = False) -> List[Dict]:
        """è·å–NapCatç‰ˆæœ¬åˆ—è¡¨"""
        # ä»GitHub APIè·å–æœ€æ–°releases
        url = f"{self.github_api_base}/repos/{self.napcat_repo}/releases"
        response = requests.get(url, headers=headers, timeout=30)
        
        napcat_versions = []
        for release in releases[:5]:  # æœ€æ–°5ä¸ªç‰ˆæœ¬
            tag_name = release.get("tag_name", "")
            assets = release.get("assets", [])
            
            # åˆ†ç±»èµ„äº§
            for asset in assets:
                if asset_name == "NapCat.Shell.zip":
                    napcat_versions.append({
                        "name": f"{tag_name}-shell",
                        "display_name": f"{tag_name} åŸºç¡€ç‰ˆ (æ¨è)",
                        "description": "æœ€æ¨èçš„ç‰ˆæœ¬ï¼Œé€‚åˆå¤§å¤šæ•°ç”¨æˆ·",
                        "download_url": asset.get("browser_download_url", "")
                    })
```

1. **åŸºç¡€ç‰ˆ (Shell)**:
   - **æ¨èé€‰æ‹©**: èµ„æºå ç”¨å°‘ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ
   - **æ— ç•Œé¢**: é€‚åˆæœåŠ¡å™¨éƒ¨ç½²
   - **è½»é‡çº§**: æœ€å°åŒ–ç³»ç»Ÿä¾èµ–

2. **æœ‰å¤´ä¸€é”®åŒ… (Framework)**:
   - **å¯è§†åŒ–ç•Œé¢**: å¸¦å®Œæ•´ QQ ç•Œé¢
   - **é™„ä½“åŠŸèƒ½**: æ”¯æŒ QQ è´¦å·é™„ä½“å‘æ¶ˆæ¯
   - **ç”¨æˆ·å‹å¥½**: é€‚åˆæ¡Œé¢ç”¨æˆ·

3. **æ— å¤´ä¸€é”®åŒ… (Shell OneKey)**:
   - **ä¸€é”®å®‰è£…**: è‡ªåŠ¨åŒ–ç¨‹åº¦æœ€é«˜
   - **æ— ç•Œé¢**: é€‚åˆè‡ªåŠ¨åŒ–éƒ¨ç½²
   - **å¿«é€Ÿå¯åŠ¨**: æœ€å°åŒ–é…ç½®æ­¥éª¤

#### æ™ºèƒ½å®‰è£…æµç¨‹

```python
def install_napcat(self, deploy_config: Dict, bot_path: str) -> str:
    """å®‰è£…NapCat"""
    napcat_version = deploy_config["napcat_version"]
    
    # ä¸‹è½½NapCat
    napcat_exe = self.download_napcat(napcat_version, install_dir)
    if napcat_exe:
        # ç­‰å¾…ç”¨æˆ·å®Œæˆå®‰è£…
        napcat_path = self._wait_for_napcat_installation(install_dir)
        if napcat_path:
            return napcat_path
    
    return ""

def _wait_for_napcat_installation(self, install_dir: str) -> Optional[str]:
    """ç­‰å¾…NapCatå®‰è£…å®Œæˆå¹¶æ£€æµ‹è·¯å¾„"""
    for attempt in range(1, 4):  # æœ€å¤šæ£€æµ‹3æ¬¡
        napcat_path = self.find_installed_napcat(install_dir)
        if napcat_path:
            return napcat_path
        
        if attempt < 3:
            time.sleep(5)  # ç­‰å¾…5ç§’åé‡è¯•
    
    return None
```

::: warning NapCat å®‰è£…æ³¨æ„äº‹é¡¹
- **æƒé™è¦æ±‚**: å®‰è£…è¿‡ç¨‹å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
- **å®‰å…¨è½¯ä»¶**: æ€æ¯’è½¯ä»¶å¯èƒ½è¯¯æŠ¥ï¼Œå»ºè®®æ·»åŠ ä¿¡ä»»
- **è´¦å·å®‰å…¨**: å»ºè®®ä½¿ç”¨ä¸“é—¨çš„ QQ å°å·
- **ç½‘ç»œç¯å¢ƒ**: ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š
:::

### WebUI éƒ¨ç½²ç³»ç»Ÿ

#### MaiBot WebUI æ¶æ„

```python
class WebUIComponent(_LaunchComponent):
    """WebUIç»„ä»¶ - æä¾›ç½‘é¡µç®¡ç†ç•Œé¢"""
    
    def start(self, process_manager: _ProcessManager) -> bool:
        webui_path = self.config.get("webui_path", "")
        
        # ä¼˜å…ˆä½¿ç”¨ bun åŠ é€Ÿæ„å»º
        bun_cmd = self._resolve_bun_command(webui_path)
        if bun_cmd:
            bun_exec = f'"{bun_cmd}"'
        else:
            bun_exec = "bun"
        
        # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
        command = f"{bun_exec} run dev -- --port 7999"
        process = process_manager.start_in_new_cmd(command, webui_path, title)
        
        # è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
        webbrowser.open("http://localhost:7999")
        return True
```

**æŠ€æœ¯æ ˆ**:
- **å‰ç«¯**: Vue.js 3 + TypeScript + Vite
- **åç«¯**: Python Flask + FastAPI
- **æ„å»ºå·¥å…·**: Bun (é«˜æ€§èƒ½åŒ…ç®¡ç†å™¨)

#### MoFox_bot åå°ç®¡ç†

```python
def _install_mofox_admin_ui(self, deploy_config: Dict) -> Tuple[bool, str]:
    """å®‰è£…MoFox_botåå°ç®¡ç†WebUI"""
    # æ£€æŸ¥Node.jsç¯å¢ƒ
    if not webui_installer.check_nodejs_installed():
        if ui.confirm("æ˜¯å¦è‡ªåŠ¨å®‰è£…Node.jsï¼Ÿ"):
            webui_installer.install_nodejs()
    
    # ä¸‹è½½å¹¶å®‰è£…WebUI
    download_url = "https://github.com/MoFox-Studio/MoFox-UI/archive/refs/heads/main.zip"
    
    with tempfile.TemporaryDirectory() as temp_dir:
        archive_path = os.path.join(temp_dir, "mofox_ui.zip")
        
        if self.download_file(download_url, archive_path):
            self.extract_archive(archive_path, temp_dir)
            
            # å®‰è£…npmä¾èµ–
            result = subprocess.run(
                ["npm", "install"],
                cwd=webui_path,
                capture_output=True,
                text=True
            )
            
            return result.returncode == 0, webui_path
```

### ç«¯å£ç®¡ç†ç³»ç»Ÿ

#### æ™ºèƒ½ç«¯å£åˆ†é…

```python
class PortManager:
    """ç«¯å£ç®¡ç†å™¨ - è´Ÿè´£æ£€æµ‹ç«¯å£å†²çªã€åˆ†é…å¯ç”¨ç«¯å£"""
    
    COMMON_PORTS = {
        "mai_main": (8000, 8100),      # MaiBotä¸»ç¨‹åºç«¯å£èŒƒå›´
        "mai_webui": (8001, 8101),     # MaiBot WebUIç«¯å£èŒƒå›´
        "mofox_main": (8000, 8100),    # MoFox_botä¸»ç¨‹åºç«¯å£èŒƒå›´
        "napcat": (8090, 8190),        # NapCatç«¯å£èŒƒå›´
        "webui": (7990, 8090),         # æ§åˆ¶é¢æ¿ç«¯å£èŒƒå›´
    }
    
    def get_next_instance_port(self, instance_type: str, base_config: Dict) -> Tuple[int, int]:
        """ä¸ºæ–°å®ä¾‹è·å–ä¸‹ä¸€ä¸ªå¯ç”¨ç«¯å£ç»„åˆ"""
        if instance_type == "MaiBot":
            main_port = self.find_available_port("mai_main")
            webui_port = self.find_available_port("mai_webui", main_port + 1)
            return main_port, webui_port
        elif instance_type == "MoFox_bot":
            main_port = self.find_available_port("mofox_main")
            napcat_port = self.find_available_port("napcat", main_port + 1)
            return main_port, napcat_port
```

#### é…ç½®æ–‡ä»¶è‡ªåŠ¨æ›´æ–°

```python
def update_env_file(self, env_path: str, main_port: int, webui_port: Optional[int] = None) -> bool:
    """æ›´æ–°.envæ–‡ä»¶ä¸­çš„ç«¯å£é…ç½®"""
    with open(env_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # æ›´æ–°ç«¯å£é…ç½®
    content = re.sub(r'PORT=\d+', f'PORT={main_port}', content)
    
    if webui_port is not None:
        content = re.sub(r'WEBUI_PORT=\d+', f'WEBUI_PORT={webui_port}', content)
        content = re.sub(r'WEBUI_ENABLED=.*', 'WEBUI_ENABLED=true', content)
    
    with open(env_path, 'w', encoding='utf-8') as f:
        f.write(content)
    
    return True
```

### MongoDB æ•°æ®åº“é›†æˆ

#### ç‰ˆæœ¬ä¾èµ–æ£€æµ‹

```python
def needs_mongodb(version: str) -> bool:
    """æ£€æµ‹ç‰ˆæœ¬æ˜¯å¦éœ€è¦MongoDBï¼ˆ0.7ä»¥ä¸‹ç‰ˆæœ¬éœ€è¦ï¼‰"""
    if version == "classical":
        return True
    
    # åˆ†æ”¯ç‰ˆæœ¬åˆ¤æ–­
    if "main" in version or "dev" in version:
        return False  # åˆ†æ”¯ç‰ˆæœ¬é»˜è®¤ä¸éœ€è¦
    
    try:
        # ç§»é™¤vå‰ç¼€
        if version.startswith("v"):
            version = version[1:]
        
        version_parts = version.split('.')
        if len(version_parts) >= 2:
            major = int(version_parts[0])
            minor = int(version_parts[1])
            
            # æ£€æŸ¥æ˜¯å¦å°äº0.7.0
            return major < 0 or (major == 0 and minor < 7)
    except (ValueError, IndexError):
        return True  # æ— æ³•è§£ææ—¶ï¼Œä¿å®ˆåœ°å‡è®¾éœ€è¦
    
    return False
```


## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### é…ç½®æ–‡ä»¶ç”Ÿæˆç³»ç»Ÿ

éƒ¨ç½²ç³»ç»Ÿä¼šæ ¹æ® Bot ç±»å‹å’Œç‰ˆæœ¬è‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼š

```python
def setup_config_files(self, deploy_config: Dict, bot_path: str,
                      adapter_path: str = "", napcat_path: str = "",
                      mongodb_path: str = "", webui_path: str = "") -> bool:
    """è®¾ç½®é…ç½®æ–‡ä»¶"""
    version_name = deploy_config.get("selected_version", {}).get("name", "")
    
    # æ ¹æ®ç‰ˆæœ¬é€‰æ‹©é…ç½®æ–‡ä»¶æ¨¡æ¿
    if compare_versions(version_name, "0.10.0") >= 0:
        # æ–°ç‰ˆæœ¬é…ç½®
        self._setup_modern_config(bot_path, deploy_config)
    else:
        # æ—§ç‰ˆæœ¬é…ç½®
        self._setup_legacy_config(bot_path, deploy_config)
    
    # è®¾ç½®é€‚é…å™¨é…ç½®
    if adapter_path and adapter_path not in ["æ— éœ€é€‚é…å™¨", "è·³è¿‡é€‚é…å™¨å®‰è£…"]:
        self._setup_adapter_config(adapter_path)
    
    return True
```

### bot_config.toml

æœºå™¨äººæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š

**ä»…å±•ç¤ºæœ€é‡è¦çš„äººæ ¼é…ç½®ç­‰éƒ¨åˆ†**
::: details MaiBot
```toml

[bot]
platform = "qq" 
qq_account = "1145141919810" # éº¦éº¦çš„QQè´¦å·

platforms = ["wx:114514","xx:1919810"] # éº¦éº¦çš„å…¶ä»–å¹³å°è´¦å·

nickname = "éº¦éº¦" # éº¦éº¦çš„æ˜µç§°
alias_names = ["éº¦å ", "ç‰¢éº¦"] # éº¦éº¦çš„åˆ«å

[personality]
# å»ºè®®120å­—ä»¥å†…ï¼Œæè¿°äººæ ¼ç‰¹è´¨ å’Œ èº«ä»½ç‰¹å¾
personality = "æ˜¯ä¸€ä¸ªå¥³å¤§å­¦ç”Ÿï¼Œç°åœ¨åœ¨è¯»å¤§äºŒï¼Œä¼šåˆ·è´´å§ã€‚" 
# ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒãªã„ ç”Ÿã¾ã‚Œãªã„ã‚‰ã‚‰ã‚‰ã‚‰
# æè¿°éº¦éº¦è¯´è¯çš„è¡¨è¾¾é£æ ¼ï¼Œè¡¨è¾¾ä¹ æƒ¯ï¼Œå¦‚è¦ä¿®æ”¹ï¼Œå¯ä»¥é…Œæƒ…æ–°å¢å†…å®¹
reply_style = "è¯·å›å¤çš„å¹³æ·¡ä¸€äº›ï¼Œç®€çŸ­ä¸€äº›ï¼Œè¯´ä¸­æ–‡ï¼Œä¸è¦åˆ»æ„çªå‡ºè‡ªèº«å­¦ç§‘èƒŒæ™¯ã€‚å¯ä»¥å‚è€ƒè´´å§ï¼ŒçŸ¥ä¹å’Œå¾®åšçš„å›å¤é£æ ¼ã€‚"

# éº¦éº¦çš„å…´è¶£ï¼Œä¼šå½±å“éº¦éº¦å¯¹ä»€ä¹ˆè¯é¢˜è¿›è¡Œå›å¤
interest = "å¯¹æŠ€æœ¯ç›¸å…³è¯é¢˜ï¼Œæ¸¸æˆå’ŒåŠ¨æ¼«ç›¸å…³è¯é¢˜æ„Ÿå…´è¶£ï¼Œä¹Ÿå¯¹æ—¥å¸¸è¯é¢˜æ„Ÿå…´è¶£ï¼Œä¸å–œæ¬¢å¤ªè¿‡æ²‰é‡ä¸¥è‚ƒçš„è¯é¢˜"

# éº¦éº¦çš„è¯´è¯è§„åˆ™ï¼Œè¡Œä¸ºé£æ ¼:
plan_style = """
1.æ€è€ƒ**æ‰€æœ‰**çš„å¯ç”¨çš„actionä¸­çš„**æ¯ä¸ªåŠ¨ä½œ**æ˜¯å¦ç¬¦åˆå½“ä¸‹æ¡ä»¶ï¼Œå¦‚æœåŠ¨ä½œä½¿ç”¨æ¡ä»¶ç¬¦åˆèŠå¤©å†…å®¹å°±ä½¿ç”¨
2.å¦‚æœç›¸åŒçš„å†…å®¹å·²ç»è¢«æ‰§è¡Œï¼Œè¯·ä¸è¦é‡å¤æ‰§è¡Œ
3.è¯·æ§åˆ¶ä½ çš„å‘è¨€é¢‘ç‡ï¼Œä¸è¦å¤ªè¿‡é¢‘ç¹çš„å‘è¨€
4.å¦‚æœæœ‰äººå¯¹ä½ æ„Ÿåˆ°åŒçƒ¦ï¼Œè¯·å‡å°‘å›å¤
5.å¦‚æœæœ‰äººå¯¹ä½ è¿›è¡Œæ”»å‡»ï¼Œæˆ–è€…æƒ…ç»ªæ¿€åŠ¨ï¼Œè¯·ä½ ä»¥åˆé€‚çš„æ–¹æ³•åº”å¯¹"""

# éº¦éº¦è¯†å›¾è§„åˆ™ï¼Œä¸å»ºè®®ä¿®æ”¹
visual_style = "è¯·ç”¨ä¸­æ–‡æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹ã€‚å¦‚æœæœ‰æ–‡å­—ï¼Œè¯·æŠŠæ–‡å­—æè¿°æ¦‚æ‹¬å‡ºæ¥ï¼Œè¯·ç•™æ„å…¶ä¸»é¢˜ï¼Œç›´è§‚æ„Ÿå—ï¼Œè¾“å‡ºä¸ºä¸€æ®µå¹³æ–‡æœ¬ï¼Œæœ€å¤š30å­—ï¼Œè¯·æ³¨æ„ä¸è¦åˆ†ç‚¹ï¼Œå°±è¾“å‡ºä¸€æ®µæ–‡æœ¬"

# éº¦éº¦ç§èŠçš„è¯´è¯è§„åˆ™ï¼Œè¡Œä¸ºé£æ ¼:
private_plan_style = """
1.æ€è€ƒ**æ‰€æœ‰**çš„å¯ç”¨çš„actionä¸­çš„**æ¯ä¸ªåŠ¨ä½œ**æ˜¯å¦ç¬¦åˆå½“ä¸‹æ¡ä»¶ï¼Œå¦‚æœåŠ¨ä½œä½¿ç”¨æ¡ä»¶ç¬¦åˆèŠå¤©å†…å®¹å°±ä½¿ç”¨
2.å¦‚æœç›¸åŒçš„å†…å®¹å·²ç»è¢«æ‰§è¡Œï¼Œè¯·ä¸è¦é‡å¤æ‰§è¡Œ
3.æŸå¥è¯å¦‚æœå·²ç»è¢«å›å¤è¿‡ï¼Œä¸è¦é‡å¤å›å¤"""

# çŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºäººæ ¼å¤šæ ·æ€§ï¼Œä¼šéšæœºæ›¿æ¢äººæ ¼
states = [
    "æ˜¯ä¸€ä¸ªå¥³å¤§å­¦ç”Ÿï¼Œå–œæ¬¢ä¸Šç½‘èŠå¤©ï¼Œä¼šåˆ·å°çº¢ä¹¦ã€‚" ,
    "æ˜¯ä¸€ä¸ªå¤§äºŒå¿ƒç†å­¦ç”Ÿï¼Œä¼šåˆ·è´´å§å’Œä¸­å›½çŸ¥ç½‘ã€‚" ,
    "æ˜¯ä¸€ä¸ªèµ›åšç½‘å‹ï¼Œæœ€è¿‘å¾ˆæƒ³åæ§½äººã€‚" 
]

# æ›¿æ¢æ¦‚ç‡ï¼Œæ¯æ¬¡æ„å»ºäººæ ¼æ—¶æ›¿æ¢personalityçš„æ¦‚ç‡ï¼ˆ0.0-1.0ï¼‰
state_probability = 0.3
```
:::

::: details MoXof_bot
``` toml

[bot]
platform = "qq"
qq_account = 1145141919810 # MoFox-Botçš„QQè´¦å·
nickname = "å¢¨ç‹" # MoFox-Botçš„æ˜µç§°
alias_names = ["ç‹ç‹", "å¢¨å¢¨"] # MoFox-Botçš„åˆ«å

[command]
command_prefixes = ['/']

[personality]
# å»ºè®®50å­—ä»¥å†…ï¼Œæè¿°äººæ ¼çš„æ ¸å¿ƒç‰¹è´¨
personality_core = "æ˜¯ä¸€ä¸ªç§¯æå‘ä¸Šçš„å¥³å¤§å­¦ç”Ÿ" 
# äººæ ¼çš„ç»†èŠ‚ï¼Œæè¿°äººæ ¼çš„ä¸€äº›ä¾§é¢
personality_side = "ç”¨ä¸€å¥è¯æˆ–å‡ å¥è¯æè¿°äººæ ¼çš„ä¾§é¢ç‰¹è´¨"
#ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒãªã„ ç”Ÿã¾ã‚Œãªã„ã‚‰ã‚‰ã‚‰ã‚‰
# å¯ä»¥æè¿°å¤–è²Œï¼Œæ€§åˆ«ï¼Œèº«é«˜ï¼ŒèŒä¸šï¼Œå±æ€§ç­‰ç­‰æè¿°
identity = "å¹´é¾„ä¸º19å²,æ˜¯å¥³å­©å­,èº«é«˜ä¸º160cm,æœ‰é»‘è‰²çš„çŸ­å‘"

# æ­¤å¤„ç”¨äºå¡«å†™è¯¦ç»†çš„ä¸–ç•Œè§‚ã€èƒŒæ™¯æ•…äº‹ã€å¤æ‚äººé™…å…³ç³»ç­‰ã€‚
# è¿™éƒ¨åˆ†å†…å®¹å°†ä½œä¸ºBotçš„â€œèƒŒæ™¯çŸ¥è¯†â€ï¼ŒBotè¢«æŒ‡å¯¼ä¸åº”åœ¨å¯¹è¯ä¸­ä¸»åŠ¨æˆ–é¢‘ç¹åœ°å¤è¿°è¿™äº›è®¾å®šã€‚
background_story = ""

# æè¿°MoFox-Botè¯´è¯çš„è¡¨è¾¾é£æ ¼ï¼Œè¡¨è¾¾ä¹ æƒ¯ï¼Œå¦‚è¦ä¿®æ”¹ï¼Œå¯ä»¥é…Œæƒ…æ–°å¢å†…å®¹
reply_style = "å›å¤å¯ä»¥ç®€çŸ­ä¸€äº›ã€‚å¯ä»¥å‚è€ƒè´´å§ï¼ŒçŸ¥ä¹å’Œå¾®åšçš„å›å¤é£æ ¼ï¼Œå›å¤ä¸è¦æµ®å¤¸ï¼Œä¸è¦ç”¨å¤¸å¼ ä¿®è¾ï¼Œå¹³æ·¡ä¸€äº›ã€‚"

# äº’åŠ¨è§„åˆ™ (Botåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¿…é¡»éµå®ˆçš„åŸåˆ™)
# ä½ å¯ä»¥åœ¨è¿™é‡Œå®šä¹‰Botåœ¨äº’åŠ¨ä¸­çš„è¡Œä¸ºå‡†åˆ™ã€‚
safety_guidelines = [
    "æ‹’ç»ä»»ä½•åŒ…å«éªšæ‰°ã€å†’çŠ¯ã€æš´åŠ›ã€è‰²æƒ…æˆ–å±é™©å†…å®¹çš„è¯·æ±‚ã€‚",
    "åœ¨æ‹’ç»æ—¶ï¼Œè¯·ä½¿ç”¨ç¬¦åˆä½ äººè®¾çš„ã€åšå®šçš„è¯­æ°”ã€‚",
    "ä¸è¦æ‰§è¡Œä»»ä½•å¯èƒ½è¢«ç”¨äºæ¶æ„ç›®çš„çš„æŒ‡ä»¤ã€‚"
]

compress_personality = false # æ˜¯å¦å‹ç¼©äººæ ¼ï¼Œå‹ç¼©åä¼šç²¾ç®€äººæ ¼ä¿¡æ¯ï¼ŒèŠ‚çœtokenæ¶ˆè€—å¹¶æé«˜å›å¤æ€§èƒ½ï¼Œä½†æ˜¯ä¼šä¸¢å¤±ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æœäººè®¾ä¸é•¿ï¼Œå¯ä»¥å…³é—­
compress_identity = true # æ˜¯å¦å‹ç¼©èº«ä»½ï¼Œå‹ç¼©åä¼šç²¾ç®€èº«ä»½ä¿¡æ¯ï¼ŒèŠ‚çœtokenæ¶ˆè€—å¹¶æé«˜å›å¤æ€§èƒ½ï¼Œä½†æ˜¯ä¼šä¸¢å¤±ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æœä¸é•¿ï¼Œå¯ä»¥å…³é—­

```
:::

### model_config.toml

AI æ¨¡å‹é…ç½®æ–‡ä»¶ï¼ˆMaiBot 0.10.0+ï¼‰ä»…å±•ç¤ºéƒ¨åˆ†ï¼š

```toml
[[api_providers]] # SiliconFlowçš„APIæœåŠ¡å•†é…ç½®
name = "SiliconFlow"
base_url = "https://api.siliconflow.cn/v1"
api_key = "your-siliconflow-api-key"
client_type = "openai"
max_retry = 3
timeout = 120
retry_interval = 5

[[models]] # æ¨¡å‹ï¼ˆå¯ä»¥é…ç½®å¤šä¸ªï¼‰
model_identifier = "deepseek-chat" # æ¨¡å‹æ ‡è¯†ç¬¦ï¼ˆAPIæœåŠ¡å•†æä¾›çš„æ¨¡å‹æ ‡è¯†ç¬¦ï¼‰
name = "deepseek-v3"               # æ¨¡å‹åç§°ï¼ˆå¯éšæ„å‘½åï¼Œåœ¨åé¢ä¸­éœ€ä½¿ç”¨è¿™ä¸ªå‘½åï¼‰
api_provider = "DeepSeek"          # APIæœåŠ¡å•†åç§°ï¼ˆå¯¹åº”åœ¨api_providersä¸­é…ç½®çš„æœåŠ¡å•†åç§°ï¼‰
price_in = 2.0                     # è¾“å…¥ä»·æ ¼ï¼ˆç”¨äºAPIè°ƒç”¨ç»Ÿè®¡ï¼Œå•ä½ï¼šå…ƒ/ M tokenï¼‰ï¼ˆå¯é€‰ï¼Œè‹¥æ— è¯¥å­—æ®µï¼Œé»˜è®¤å€¼ä¸º0ï¼‰
price_out = 8.0                    # è¾“å‡ºä»·æ ¼ï¼ˆç”¨äºAPIè°ƒç”¨ç»Ÿè®¡ï¼Œå•ä½ï¼šå…ƒ/ M tokenï¼‰ï¼ˆå¯é€‰ï¼Œè‹¥æ— è¯¥å­—æ®µï¼Œé»˜è®¤å€¼ä¸º0ï¼‰
# force_stream_mode = true          # å¼ºåˆ¶æµå¼è¾“å‡ºæ¨¡å¼ï¼ˆè‹¥æ¨¡å‹ä¸æ”¯æŒéæµå¼è¾“å‡ºï¼Œè¯·å–æ¶ˆè¯¥æ³¨é‡Šï¼Œå¯ç”¨å¼ºåˆ¶æµå¼è¾“å‡ºï¼Œè‹¥æ— è¯¥å­—æ®µï¼Œé»˜è®¤å€¼ä¸ºfalseï¼‰

[model_task_config.utils] # åœ¨éº¦éº¦çš„ä¸€äº›ç»„ä»¶ä¸­ä½¿ç”¨çš„æ¨¡å‹ï¼Œä¾‹å¦‚è¡¨æƒ…åŒ…æ¨¡å—ï¼Œå–åæ¨¡å—ï¼Œå…³ç³»æ¨¡å—ï¼Œéº¦éº¦çš„æƒ…ç»ªå˜åŒ–ç­‰ï¼Œæ˜¯éº¦éº¦å¿…é¡»çš„æ¨¡å‹
model_list = ["siliconflow-deepseek-v3.2"] # ä½¿ç”¨çš„æ¨¡å‹åˆ—è¡¨ï¼Œæ¯ä¸ªå­é¡¹å¯¹åº”ä¸Šé¢çš„æ¨¡å‹åç§°(name)
temperature = 0.2                        # æ¨¡å‹æ¸©åº¦ï¼Œæ–°V3å»ºè®®0.1-0.3
max_tokens = 2048                         # æœ€å¤§è¾“å‡ºtokenæ•°
slow_threshold = 15.0                     # æ…¢è¯·æ±‚é˜ˆå€¼ï¼ˆç§’ï¼‰ï¼Œæ¨¡å‹ç­‰å¾…å›å¤æ—¶é—´è¶…è¿‡æ­¤å€¼ä¼šè¾“å‡ºè­¦å‘Šæ—¥å¿—

```

### .env

ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼š

```env
# éº¦éº¦
# éº¦éº¦ä¸»ç¨‹åºé…ç½®
HOST=127.0.0.1
PORT=8000

# WebUI ç‹¬ç«‹æœåŠ¡å™¨é…ç½®
WEBUI_ENABLED=true
WEBUI_MODE=production   # æ¨¡å¼: development(å¼€å‘) æˆ– production(ç”Ÿäº§)
WEBUI_HOST=127.0.0.1    # WebUI æœåŠ¡å™¨ç›‘å¬åœ°å€ï¼ˆé»˜è®¤ä»…æœ¬åœ°è®¿é—®ï¼Œè®¾ç½®ä¸º0.0.0.0å¯å…è®¸å¤–éƒ¨è®¿é—®ï¼‰
WEBUI_PORT=8000         # WebUI æœåŠ¡å™¨ç«¯å£
# ------------------------------------------------------------------
# å¢¨ç‹
HOST=127.0.0.1
PORT=8000
EULA_CONFIRMED=true     # éšç§åè®®
```

### é…ç½®æ–‡ä»¶æ¨¡æ¿ç³»ç»Ÿ

```python
def _copy_config_template(self, template_path: str, target_path: str, replacements: Dict[str, str]):
    """å¤åˆ¶å¹¶æ›¿æ¢é…ç½®æ¨¡æ¿"""
    with open(template_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # æ‰§è¡Œå˜é‡æ›¿æ¢
    for key, value in replacements.items():
        content = content.replace(f"{{{key}}}", str(value))
    
    # ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨
    os.makedirs(os.path.dirname(target_path), exist_ok=True)
    
    with open(target_path, 'w', encoding='utf-8') as f:
        f.write(content)
```


## â“ å¸¸è§é—®é¢˜è§£å†³

### ç½‘ç»œè¿æ¥é—®é¢˜

#### é—®é¢˜ 1: GitHub API é™åˆ¶

**ç—‡çŠ¶**:
```bash
ç½‘ç»œè¿æ¥å¤±è´¥: æ— æ³•è¿æ¥åˆ°GitHubå’ŒPyPIé•œåƒç«™ç‚¹
```

**æŠ€æœ¯åˆ†æ**:
```python
def check_network_connection(self) -> Tuple[bool, str]:
    """ç½‘ç»œè¿æ¥æ£€æŸ¥å®ç°"""
    endpoints = [
        ("https://api.github.com", "GitHub API"),
        ("https://github.com", "GitHub"),
        ("https://pypi.tuna.tsinghua.edu.cn", "æ¸…åPyPIé•œåƒ")
    ]
    
    for url, name in endpoints:
        try:
            response = requests.get(url, timeout=5)
            if response.status_code in [200, 301, 302]:
                return True, ""
        except Exception:
            continue
    
    return False, "æ— æ³•è¿æ¥åˆ°GitHubå’ŒPyPIé•œåƒç«™ç‚¹"
```

**è§£å†³æ–¹æ¡ˆ**:
1. **ç­‰å¾…é‡è¯•**: GitHub API é€Ÿç‡é™åˆ¶é€šå¸¸åœ¨ å‡ ç§’å†…æ¢å¤
2. **ä»£ç†é…ç½®**: é…ç½®ä»£ç†æˆ–ä½¿ç”¨æ‰‹æœºçƒ­ç‚¹
3. **ç¦»çº¿æ¨¡å¼**: ä½¿ç”¨æœ¬åœ°ç¼“å­˜ç»§ç»­éƒ¨ç½²

#### é—®é¢˜ 2: æ–‡ä»¶ä¸‹è½½å¤±è´¥

**ç—‡çŠ¶**:
```bash
ä¸‹è½½å¤±è´¥ï¼ˆå·²é‡è¯•3æ¬¡ï¼‰: Connection timeout
```

**é‡è¯•æœºåˆ¶å®ç°**:
```python
def download_file(self, url: str, filename: str, max_retries: int = 3) -> bool:
    """å¸¦é‡è¯•æœºåˆ¶çš„æ–‡ä»¶ä¸‹è½½"""
    for attempt in range(max_retries):
        try:
            response = requests.get(url, stream=True, timeout=30)
            response.raise_for_status()
            
            # ä½¿ç”¨Richè¿›åº¦æ¡æ˜¾ç¤ºä¸‹è½½è¿›åº¦
            with Progress(...) as progress:
                task = progress.add_task(f"ä¸‹è½½ {file_basename}", total=total_size)
                for chunk in response.iter_content(chunk_size=8192):
                    if chunk:
                        f.write(chunk)
                        progress.update(task, advance=len(chunk))
            
            return True
            
        except requests.RequestException as e:
            if attempt < max_retries - 1:
                time.sleep(2)  # æŒ‡æ•°é€€é¿
                continue
            return False
```

### ä¾èµ–å®‰è£…é—®é¢˜

#### é—®é¢˜ 3: Python è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå¤±è´¥

**ç—‡çŠ¶**:
```bash
è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå¤±è´¥: Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°
```

**è™šæ‹Ÿç¯å¢ƒç®¡ç†**:
```python
def create_virtual_environment(self, target_dir: str) -> Tuple[bool, str]:
    """åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ"""
    venv_path = os.path.join(target_dir, "venv")
    
    if os.path.exists(venv_path):
        shutil.rmtree(venv_path)  # æ¸…ç†æ—§ç¯å¢ƒ
    
    venv.create(venv_path, with_pip=True)
    
    # éªŒè¯è™šæ‹Ÿç¯å¢ƒ
    if platform.system() == "Windows":
        python_exe = os.path.join(venv_path, "Scripts", "python.exe")
    else:
        python_exe = os.path.join(venv_path, "bin", "python")
    
    if not os.path.exists(python_exe):
        raise Exception("è™šæ‹Ÿç¯å¢ƒPythonè§£é‡Šå™¨æœªæ‰¾åˆ°")
    
    return True, venv_path
```

**è§£å†³æ–¹æ¡ˆ**:
1. **Python ç¯å¢ƒæ£€æŸ¥**: ç¡®ä¿ Python 3.8+ å·²å®‰è£…å¹¶æ·»åŠ åˆ° PATH
2. **æƒé™é—®é¢˜**: ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œç¨‹åº
3. **è·¯å¾„é—®é¢˜**: é€‰æ‹©ç”¨æˆ·ç›®å½•ä½œä¸ºå®‰è£…è·¯å¾„

#### é—®é¢˜ 4: ä¾èµ–åŒ…å®‰è£…å¤±è´¥

**ç—‡çŠ¶**:
```bash
ERROR: Could not find a version that satisfies the requirement
```

**å¤šé•œåƒæºç­–ç•¥**:
```python
pypi_mirrors = [
    "https://pypi.tuna.tsinghua.edu.cn/simple",
    "https://pypi.org/simple",
    "https://mirrors.aliyun.com/pypi/simple",
    "https://pypi.douban.com/simple"
]

def install_dependencies_in_venv(self, venv_path: str, requirements_path: str) -> bool:
    """å¤šé•œåƒæºä¾èµ–å®‰è£…"""
    for i, mirror in enumerate(pypi_mirrors, 1):
        cmd = [
            pip_exe, "install",
            "-r", requirements_path,
            "-i", mirror
        ]
        
        if run_command_with_output(cmd, f"ä½¿ç”¨é•œåƒæº{i}å®‰è£…ä¾èµ–"):
            return True
    
    return False  # æ‰€æœ‰é•œåƒæºéƒ½å¤±è´¥
```

### ç«¯å£å†²çªé—®é¢˜

#### é—®é¢˜ 5: ç«¯å£å ç”¨

**ç—‡çŠ¶**:
```bash
ç«¯å£ 8000 å·²è¢«å ç”¨
```

**ç«¯å£å†²çªæ£€æµ‹**:
```python
def is_port_available(self, port: int) -> bool:
    """æ£€æŸ¥ç«¯å£æ˜¯å¦å¯ç”¨"""
    if port in self.RESERVED_PORTS:
        return False
    
    # ä½¿ç”¨socketæ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
    try:
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
            sock.settimeout(1)
            result = sock.connect_ex(('localhost', port))
            return result != 0
    except Exception:
        return False

def find_available_port(self, port_type: str, base_port: Optional[int] = None) -> int:
    """æŸ¥æ‰¾å¯ç”¨ç«¯å£"""
    start_port, _ = self.COMMON_PORTS[port_type]
    search_port = base_port or start_port
    
    # å°è¯•ä»åŸºç¡€ç«¯å£å¼€å§‹æŸ¥æ‰¾
    for offset in range(100):
        test_port = search_port + offset
        if self.is_port_available(test_port):
            return test_port
    
    # æ‰©å±•æœç´¢èŒƒå›´
    for port in range(1024, 65535):
        if self.is_port_available(port):
            return port
    
    raise RuntimeError("æ— æ³•æ‰¾åˆ°å¯ç”¨ç«¯å£")
```

**è§£å†³æ–¹æ¡ˆ**:
1. **è‡ªåŠ¨é‡è¯•**: ç³»ç»Ÿä¼šè‡ªåŠ¨å¯»æ‰¾ä¸‹ä¸€ä¸ªå¯ç”¨ç«¯å£
2. **æ‰‹åŠ¨é‡Šæ”¾**: ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹
3. **ç«¯å£é…ç½®**: ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£è®¾ç½®

### é…ç½®æ–‡ä»¶é—®é¢˜

#### é—®é¢˜ 6: é…ç½®æ–‡ä»¶ç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶**:
```bash
é…ç½®æ–‡ä»¶è®¾ç½®å¤±è´¥: æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨
```

**é…ç½®æ–‡ä»¶ç”Ÿæˆå™¨**:
```python
def setup_config_files(self, deploy_config: Dict, bot_path: str,
                      adapter_path: str = "", napcat_path: str = "",
                      mongodb_path: str = "", webui_path: str = "") -> bool:
    """è®¾ç½®é…ç½®æ–‡ä»¶"""
    try:
        config_dir = os.path.join(bot_path, "config")
        template_dir = os.path.join(bot_path, "template")
        
        # å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
        bot_config_template = os.path.join(template_dir, "bot_config_template.toml")
        bot_config_target = os.path.join(config_dir, "bot_config.toml")
        
        if os.path.exists(bot_config_template):
            shutil.copy2(bot_config_template, bot_config_target)
        else:
            logger.warning(f"æœªæ‰¾åˆ°æ¨¡æ¿æ–‡ä»¶: {bot_config_template}")
        
        return True
        
    except Exception as e:
        logger.error("é…ç½®æ–‡ä»¶è®¾ç½®å¤±è´¥", error=str(e))
        return False
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ¨¡æ¿æ£€æŸ¥**: ç¡®è®¤ template ç›®å½•å’Œæ¨¡æ¿æ–‡ä»¶å­˜åœ¨
2. **æƒé™æ£€æŸ¥**: ç¡®ä¿æœ‰å†™å…¥é…ç½®ç›®å½•çš„æƒé™
3. **æ‰‹åŠ¨é…ç½®**: å¤åˆ¶æ¨¡æ¿æ–‡ä»¶å¹¶æ‰‹åŠ¨ä¿®æ”¹

### è¿è¡Œå¯åŠ¨é—®é¢˜

#### é—®é¢˜ 7: Bot å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**:
```bash
Bot å¯åŠ¨å¤±è´¥ï¼šæ¨¡å—å¯¼å…¥é”™è¯¯
```

**å¯åŠ¨éªŒè¯æœºåˆ¶**:
```python
def validate_configuration(self, config: Dict[str, Any]) -> list:
    """éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§"""
    errors = []
    
    # éªŒè¯Botè·¯å¾„
    bot_type = config.get("bot_type", "MaiBot")
    if bot_type == "MoFox_bot":
        mai_path = config.get("mofox_path", "")
    else:
        mai_path = config.get("mai_path", "")
    
    valid, msg = validate_path(mai_path, check_file="bot.py")
    if not valid:
        errors.append(f"Botè·¯å¾„: {msg}")
    
    # éªŒè¯è™šæ‹Ÿç¯å¢ƒ
    venv_path = config.get("venv_path", "")
    if venv_path and not os.path.exists(venv_path):
        errors.append("è™šæ‹Ÿç¯å¢ƒè·¯å¾„ä¸å­˜åœ¨")
    
    return errors
```

**è§£å†³æ–¹æ¡ˆ**:
1. **ä¾èµ–æ£€æŸ¥**: ç¡®è®¤æ‰€æœ‰ä¾èµ–åŒ…å·²æ­£ç¡®å®‰è£…
2. **ç¯å¢ƒæ£€æŸ¥**: éªŒè¯è™šæ‹Ÿç¯å¢ƒå’Œ Python è·¯å¾„
3. **é…ç½®æ£€æŸ¥**: ç¡®è®¤æ‰€æœ‰é…ç½®æ–‡ä»¶æ­£ç¡®

#### é—®é¢˜ 8: QQ ç™»å½•å¤±è´¥

**ç—‡çŠ¶**:
```bash
QQ ç™»å½•å¤±è´¥ï¼šè®¾å¤‡éªŒè¯
```

**NapCat è¿æ¥è¯Šæ–­**:
```python
def check_napcat_connection(self, napcat_path: str) -> bool:
    """æ£€æŸ¥NapCatè¿æ¥çŠ¶æ€"""
    try:
        # æ£€æŸ¥NapCatè¿›ç¨‹æ˜¯å¦è¿è¡Œ
        if check_process("NapCatWinBootMain.exe"):
            # å°è¯•è¿æ¥WebSocket
            import websocket
            ws = websocket.create_connection("ws://127.0.0.1:8090")
            ws.close()
            return True
    except Exception as e:
        logger.warning("NapCatè¿æ¥æ£€æŸ¥å¤±è´¥", error=str(e))
    
    return False
```

**è§£å†³æ–¹æ¡ˆ**:
1. **è´¦å·å®‰å…¨**: ä½¿ç”¨ä¸“é—¨çš„ QQ å°å·é¿å…ä¸»è´¦å·é£é™©
2. **è®¾å¤‡éªŒè¯**: æŒ‰ç…§ NapCat æç¤ºå®Œæˆè®¾å¤‡éªŒè¯
3. **ç‰ˆæœ¬æ›´æ–°**: æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ NapCat
4. **ç½‘ç»œæ£€æŸ¥**: ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š

## âš™ï¸ é«˜çº§é…ç½®

### ä»£ç†é…ç½®ç³»ç»Ÿ

#### ä¼ä¸šç½‘ç»œç¯å¢ƒé€‚é…

```python
class ProxyManager:
    """ä»£ç†ç®¡ç†å™¨ - æ”¯æŒHTTPå’ŒSOCKS5ä»£ç†"""
    
    def __init__(self):
        self.proxy_config = {
            "http": None,
            "https": None,
            "socks5": None
        }
    
    def configure_proxy(self, proxy_type: str, host: str, port: int,
                     username: str = None, password: str = None):
        """é…ç½®ä»£ç†æœåŠ¡å™¨"""
        if username and password:
            proxy_url = f"{username}:{password}@{host}:{port}"
        else:
            proxy_url = f"{host}:{port}"
        
        if proxy_type.lower() in ["http", "https"]:
            self.proxy_config[proxy_type.lower()] = f"http://{proxy_url}"
        elif proxy_type.lower() == "socks5":
            self.proxy_config["socks5"] = f"socks5://{proxy_url}"
    
    def get_proxies(self) -> Dict[str, str]:
        """è·å–ä»£ç†é…ç½®"""
        return {k: v for k, v in self.proxy_config.items() if v}
```

**é…ç½®æ–¹æ³•**:
1. **ç³»ç»Ÿä»£ç†**: Windows è®¾ç½® â†’ ç½‘ç»œå’Œ Internet â†’ ä»£ç†
2. **ç¨‹åºå†…ä»£ç†**: åœ¨è®¾ç½®ä¸­é…ç½® HTTP/SOCKS5 ä»£ç†
3. **ç¯å¢ƒå˜é‡**: è®¾ç½® `HTTP_PROXY` å’Œ `HTTPS_PROXY` ç¯å¢ƒå˜é‡

### å¤šå®ä¾‹éƒ¨ç½²æ¶æ„

#### å®ä¾‹éš”ç¦»æœºåˆ¶

```python
class InstanceMultiLauncher:
    """å®ä¾‹å¤šå¼€ç®¡ç†å™¨"""
    
    def create_multi_instance(self, base_config: Dict[str, Any], instance_name: str = None) -> str:
        """åˆ›å»ºå¤šå¼€å®ä¾‹"""
        instance_id = str(uuid.uuid4())[:8]
        
        # æ™ºèƒ½ç«¯å£åˆ†é…
        main_port, secondary_port = port_manager.get_next_instance_port(
            base_config["bot_type"], base_config
        )
        
        multi_instance = {
            "id": instance_id,
            "name": instance_name or f"å¤šå¼€å®ä¾‹_{instance_id}",
            "bot_type": base_config["bot_type"],
            "ports": {
                "main_port": main_port,
                "secondary_port": secondary_port
            },
            "status": "created"
        }
        
        self.multi_instances[instance_id] = multi_instance
        return instance_id
```

**éƒ¨ç½²ç­–ç•¥**:
1. **ç«¯å£éš”ç¦»**: æ¯ä¸ªå®ä¾‹åˆ†é…ç‹¬ç«‹çš„ç«¯å£ç»„åˆ
2. **é…ç½®éš”ç¦»**: å®ä¾‹é—´é…ç½®äº’ä¸å½±å“
3. **è¿›ç¨‹éš”ç¦»**: æ¯ä¸ªå®ä¾‹è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ç©ºé—´ä¸­

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### èµ„æºç®¡ç†ä¼˜åŒ–

```python
class ResourceOptimizer:
    """èµ„æºä¼˜åŒ–å™¨"""
    
    def optimize_memory_usage(self):
        """å†…å­˜ä½¿ç”¨ä¼˜åŒ–"""
        import gc
        
        # å¼ºåˆ¶åƒåœ¾å›æ”¶
        gc.collect()
        
        # æ¸…ç†ç¼“å­˜
        if hasattr(self, '_cache'):
            self._cache.clear()
    
    def optimize_disk_usage(self):
        """ç£ç›˜ä½¿ç”¨ä¼˜åŒ–"""
        # æ—¥å¿—è½®è½¬
        self._rotate_logs()
        
        # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        self._cleanup_temp_files()
        
        # å‹ç¼©æ—§æ•°æ®
        self._compress_old_data()
```

**ä¼˜åŒ–æªæ–½**:
1. **å†…å­˜ä¼˜åŒ–**:
   - åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡
   - ä½¿ç”¨å¼±å¼•ç”¨é¿å…å¾ªç¯å¼•ç”¨
   - é…ç½®åˆç†çš„ç¼“å­˜å¤§å°

2. **å­˜å‚¨ä¼˜åŒ–**:
   - ä½¿ç”¨ SSD æå‡ I/O æ€§èƒ½
   - å®šæœŸæ¸…ç†æ—¥å¿—å’Œä¸´æ—¶æ–‡ä»¶
   - å¯ç”¨æ—¥å¿—è½®è½¬æœºåˆ¶

3. **ç½‘ç»œä¼˜åŒ–**:
   - é…ç½®æœ¬åœ° PyPI é•œåƒ
   - ä½¿ç”¨ CDN åŠ é€Ÿä¸‹è½½
   - å¯ç”¨è¿æ¥å¤ç”¨

### ç›‘æ§ä¸ç»´æŠ¤ç³»ç»Ÿ

#### å¥åº·æ£€æŸ¥æœºåˆ¶

```python
class HealthMonitor:
    """å¥åº·ç›‘æ§å™¨"""
    
    def check_instance_health(self, instance_id: str) -> Dict[str, Any]:
        """æ£€æŸ¥å®ä¾‹å¥åº·çŠ¶æ€"""
        instance = self.multi_instances.get(instance_id)
        if not instance:
            return {"status": "not_found"}
        
        health_status = {
            "status": "healthy",
            "cpu_usage": self._get_cpu_usage(instance_id),
            "memory_usage": self._get_memory_usage(instance_id),
            "disk_usage": self._get_disk_usage(instance_id),
            "network_status": self._check_network_connectivity(),
            "last_check": datetime.now().isoformat()
        }
        
        # æ£€æŸ¥å…³é”®æŒ‡æ ‡
        if health_status["cpu_usage"] > 80:
            health_status["status"] = "warning"
        if health_status["memory_usage"] > 90:
            health_status["status"] = "critical"
        
        return health_status
```

**ç›‘æ§æŒ‡æ ‡**:
1. **ç³»ç»Ÿèµ„æº**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
2. **ç½‘ç»œçŠ¶æ€**: è¿æ¥å»¶è¿Ÿã€ä¸¢åŒ…ç‡
3. **æœåŠ¡çŠ¶æ€**: è¿›ç¨‹å­˜æ´»ã€ç«¯å£å¯ç”¨æ€§
4. **ä¸šåŠ¡æŒ‡æ ‡**: å“åº”æ—¶é—´ã€é”™è¯¯ç‡

#### è‡ªåŠ¨å¤‡ä»½ç­–ç•¥

```python
class BackupManager:
    """å¤‡ä»½ç®¡ç†å™¨"""
    
    def create_backup(self, instance_id: str, backup_type: str = "incremental") -> str:
        """åˆ›å»ºå¤‡ä»½"""
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_name = f"{instance_id}_{backup_type}_{timestamp}"
        
        instance = self.multi_instances[instance_id]
        
        if backup_type == "full":
            # å…¨é‡å¤‡ä»½
            self._create_full_backup(instance, backup_name)
        elif backup_type == "incremental":
            # å¢é‡å¤‡ä»½
            self._create_incremental_backup(instance, backup_name)
        
        return backup_name
    
    def _create_full_backup(self, instance: Dict, backup_name: str):
        """åˆ›å»ºå…¨é‡å¤‡ä»½"""
        backup_dir = f"backups/{backup_name}"
        os.makedirs(backup_dir, exist_ok=True)
        
        # å¤‡ä»½é…ç½®æ–‡ä»¶
        config_files = ["config/*.toml", ".env"]
        for pattern in config_files:
            shutil.copy2(pattern, backup_dir)
        
        # å¤‡ä»½æ•°æ®æ–‡ä»¶
        data_files = ["data/*", "logs/*"]
        for pattern in data_files:
            if os.path.exists(pattern):
                shutil.copytree(pattern, f"{backup_dir}/{os.path.basename(pattern)}")
```

**å¤‡ä»½ç­–ç•¥**:
1. **å…¨é‡å¤‡ä»½**: å®šæœŸåˆ›å»ºå®Œæ•´å¤‡ä»½
2. **å¢é‡å¤‡ä»½**: æ—¥å¸¸å¢é‡å¤‡ä»½èŠ‚çœç©ºé—´
3. **å¼‚åœ°å¤‡ä»½**: é‡è¦æ•°æ®å¼‚åœ°å­˜å‚¨
4. **è‡ªåŠ¨æ¸…ç†**: å®šæœŸæ¸…ç†è¿‡æœŸå¤‡ä»½

---

## ğŸ“ è·å–å¸®åŠ©

### å®˜æ–¹èµ„æº

<NCard title="ğŸ“š MaiBot å®˜æ–¹æ–‡æ¡£" link="https://docs.mai-mai.org">
MaiBot å®Œæ•´æŠ€æœ¯æ–‡æ¡£å’ŒAPIå‚è€ƒ
</NCard>

<NCard title="ğŸ”§ MoFox_bot GitHub ä»“åº“" link="https://github.com/MoFox-Studio/MoFox_Bot">
MoFox_bot æºç ã€é—®é¢˜åé¦ˆå’ŒåŠŸèƒ½è¯·æ±‚
</NCard>

<NCard title="ğŸ› MaiCore Start Issues" link="https://github.com/MaiM-with-u/MaiCore-Start/issues">
æäº¤BugæŠ¥å‘Šå’ŒåŠŸèƒ½å»ºè®®
</NCard>

### ç¤¾åŒºæ”¯æŒ

- **æŠ€æœ¯äº¤æµç¾¤**: åŠ å…¥ MaiBot/MoFox_bot æŠ€æœ¯äº¤æµç¾¤
- **åœ¨çº¿è®ºå›**: å‚ä¸æŠ€æœ¯è®¨è®ºå’Œç»éªŒåˆ†äº«
- **è§†é¢‘æ•™ç¨‹**: è§‚çœ‹éƒ¨ç½²å’Œé…ç½®è§†é¢‘æŒ‡å—

### é—®é¢˜åé¦ˆæŒ‡å—

æäº¤é—®é¢˜æ—¶è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

```bash
# ç³»ç»Ÿç¯å¢ƒä¿¡æ¯
æ“ä½œç³»ç»Ÿ: Windows 11
Pythonç‰ˆæœ¬: 3.11.5
MaiCore Startç‰ˆæœ¬: v4.1.2-beta

# é”™è¯¯ä¿¡æ¯
éƒ¨ç½²å¤±è´¥: ç½‘ç»œè¿æ¥è¶…æ—¶
é”™è¯¯æ—¥å¿—: [è¯¦ç»†æ—¥å¿—å†…å®¹]

# æ“ä½œæ­¥éª¤
1. å¯åŠ¨ MaiCore Start
2. é€‰æ‹©éƒ¨ç½²æ–°å®ä¾‹
3. é€‰æ‹© MaiBot v0.11.6
4. é…ç½®ç»„ä»¶æ—¶å‡ºé”™
```

---

## ğŸ“„ æ›´æ–°æ—¥å¿—

### v4.1.2-beta (2024-12-17)
- âœ¨ **æ–°å¢åŠŸèƒ½**: å®Œæ•´æ”¯æŒ MoFox_bot éƒ¨ç½²
- ğŸ—ï¸ **æ¶æ„ä¼˜åŒ–**: æ¨¡å—åŒ–éƒ¨ç½²å™¨è®¾è®¡
- ğŸ”§ **éƒ¨ç½²å¢å¼º**: æ™ºèƒ½ç‰ˆæœ¬æ£€æµ‹å’Œç»„ä»¶é€‰æ‹©
- ğŸ“Š **ç›‘æ§æ”¹è¿›**: å®æ—¶éƒ¨ç½²è¿›åº¦æ˜¾ç¤º
- ğŸ› **é—®é¢˜ä¿®å¤**: ä¿®å¤ç«¯å£å†²çªå’Œä¾èµ–å®‰è£…é—®é¢˜
- ğŸ“š **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„éƒ¨ç½²å’Œé…ç½®æ–‡æ¡£

### v4.1.1 (2024-11-15)
- ğŸš€ **æ€§èƒ½æå‡**: éƒ¨ç½²é€Ÿåº¦æå‡ 40%
- ğŸ’¾ **ç¼“å­˜ä¼˜åŒ–**: æ”¹è¿›ç‰ˆæœ¬ä¿¡æ¯ç¼“å­˜æœºåˆ¶
- ğŸ”’ **å®‰å…¨å¢å¼º**: åŠ å¼ºé…ç½®æ–‡ä»¶æƒé™ç®¡ç†
- ğŸŒ **ç½‘ç»œä¼˜åŒ–**: å¤šé•œåƒæºè‡ªåŠ¨åˆ‡æ¢

### v4.1.0 (2024-10-20)
- ğŸ‰ **é¦–æ¬¡å‘å¸ƒ**: MaiCore Start éƒ¨ç½²ç³»ç»Ÿ
- ğŸ¤– **Botæ”¯æŒ**: å®Œæ•´æ”¯æŒ MaiBot éƒ¨ç½²
- ğŸ”Œ **ç»„ä»¶é›†æˆ**: NapCatã€WebUIã€MongoDB è‡ªåŠ¨å®‰è£…
- ğŸ“± **ç”¨æˆ·ç•Œé¢**: å‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢

---

## ğŸ“œ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.8+
- **UIæ¡†æ¶**: Rich (å‘½ä»¤è¡Œç•Œé¢)
- **ç½‘ç»œè¯·æ±‚**: Requests + HTTPX
- **è¿›ç¨‹ç®¡ç†**: psutil
- **é…ç½®ç®¡ç†**: TOML
- **æ—¥å¿—ç³»ç»Ÿ**: structlog
- **åŒ…ç®¡ç†**: pip + uv (å¯é€‰)

### è®¾è®¡æ¨¡å¼

- **ç­–ç•¥æ¨¡å¼**: ä¸åŒ Bot ç±»å‹çš„å·®å¼‚åŒ–éƒ¨ç½²
- **å·¥å‚æ¨¡å¼**: ç»„ä»¶åˆ›å»ºå’Œç®¡ç†
- **è§‚å¯Ÿè€…æ¨¡å¼**: éƒ¨ç½²è¿›åº¦ç›‘æ§
- **å•ä¾‹æ¨¡å¼**: å…¨å±€é…ç½®ç®¡ç†

---

**æ„Ÿè°¢ä½¿ç”¨ MaiCore Start ä¼ä¸šçº§éƒ¨ç½²ç³»ç»Ÿï¼**

é€šè¿‡è‡ªåŠ¨åŒ–çš„éƒ¨ç½²æµç¨‹ã€æ™ºèƒ½çš„é…ç½®ç®¡ç†å’Œå¼ºå¤§çš„ç›‘æ§åŠŸèƒ½ï¼ŒMaiCore Start ä¸º Bot å¼€å‘è€…æä¾›äº†ä¸“ä¸šçº§çš„éƒ¨ç½²è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªå·¥å…·æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç»™é¡¹ç›®ç‚¹ä¸ªæ˜Ÿâ­ï¼

<!-- éƒ¨ç½²æ•™ç¨‹ç»“æŸ -->