# MaiCore Start å¯åŠ¨æŒ‡å—

> **æ¬¢è¿ä½¿ç”¨ MaiCore Start å¯åŠ¨ç³»ç»Ÿï¼** è¿™æ˜¯ä¸€ä¸ªå…¨é¢çš„å¯åŠ¨æŒ‡å—ï¼Œå°†è¯¦ç»†ä»‹ç»å¯åŠ¨æµç¨‹å’Œç¨‹åºç‹¬ç‰¹çš„ä¸‰å¤§æ ¸å¿ƒæœºåˆ¶ã€‚

::: tip æ¸©é¦¨æç¤º
æœ¬æŒ‡å—å°†æ·±å…¥é˜é‡Šé…ç½®é›†æœºåˆ¶ã€è¿›ç¨‹ç›‘æ§æœºåˆ¶å’Œå®ä¾‹å¤šå¼€æœºåˆ¶ï¼Œå¸®åŠ©æ‚¨ç†è§£ç¨‹åºçš„å¼ºå¤§åŠŸèƒ½ã€‚
:::

## ğŸ“‹ ç›®å½•

- [å¯åŠ¨æµç¨‹æ¦‚è¿°](#å¯åŠ¨æµç¨‹æ¦‚è¿°)
- [é…ç½®é›†æœºåˆ¶è¯¦è§£](#é…ç½®é›†æœºåˆ¶è¯¦è§£)
- [è¿›ç¨‹ç›‘æ§æœºåˆ¶è¯¦è§£](#è¿›ç¨‹ç›‘æ§æœºåˆ¶è¯¦è§£)
- [å®ä¾‹å¤šå¼€æœºåˆ¶è¯¦è§£](#å®ä¾‹å¤šå¼€æœºåˆ¶è¯¦è§£)
- [å¯åŠ¨æ“ä½œæŒ‡å—](#å¯åŠ¨æ“ä½œæŒ‡å—)
- [é«˜çº§åŠŸèƒ½ä½¿ç”¨](#é«˜çº§åŠŸèƒ½ä½¿ç”¨)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)


## ğŸš€ å¯åŠ¨æµç¨‹æ¦‚è¿°

### å¯åŠ¨æ¶æ„å›¾

```mermaid
graph TD
    A[å¯åŠ¨ MaiCore Start] --> B[åŠ è½½é…ç½®é›†]
    B --> C[æ˜¾ç¤ºä¸»èœå•]
    C --> D[é€‰æ‹©å®ä¾‹]
    D --> E[éªŒè¯é…ç½®]
    E --> F[å¯åŠ¨ç»„ä»¶]
    F --> G[è¿›ç¨‹ç›‘æ§]
    G --> H[å®ä¾‹è¿è¡Œ]
    
    C --> I[å®ä¾‹å¤šå¼€ç®¡ç†]
    I --> J[åˆ›å»ºå¤šå¼€å®ä¾‹]
    J --> K[ç«¯å£åˆ†é…]
    K --> L[å¤šå®ä¾‹å¯åŠ¨]
    
    F --> M[MaiBotç»„ä»¶]
    F --> N[MoFox_botç»„ä»¶]
    F --> O[é€‚é…å™¨ç»„ä»¶]
    F --> P[NapCatç»„ä»¶]
    F --> Q[WebUIç»„ä»¶]
    F --> R[MongoDBç»„ä»¶]
```

### å¯åŠ¨æµç¨‹è¯¦è§£

#### 1. ç¨‹åºåˆå§‹åŒ– ğŸ”§

å½“æ‚¨å¯åŠ¨ MaiCore Start æ—¶ï¼Œç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹é¡ºåºåˆå§‹åŒ–ï¼š

1. **é…ç½®ç³»ç»Ÿåˆå§‹åŒ–**
   - åŠ è½½ `config/config.toml` é…ç½®æ–‡ä»¶
   - éªŒè¯é…ç½®ç»“æ„å®Œæ•´æ€§
   - ä¿®å¤æŸåçš„é…ç½®æ•°æ®

2. **ç«¯å£ç®¡ç†å™¨åˆå§‹åŒ–**
   - æ‰«æç³»ç»Ÿå·²ä½¿ç”¨ç«¯å£
   - åŠ è½½ç«¯å£ä½¿ç”¨å†å²
   - å‡†å¤‡ç«¯å£åˆ†é…ç­–ç•¥

3. **UIç•Œé¢åˆå§‹åŒ–**
   - åŠ è½½ä¸»é¢˜é…ç½®
   - åˆå§‹åŒ–æ§åˆ¶å°ç•Œé¢
   - è®¾ç½®é¢œè‰²æ–¹æ¡ˆ

#### 2. ä¸»èœå•æ˜¾ç¤º ğŸ“±

ç¨‹åºæ˜¾ç¤ºåŠŸèƒ½ä¸°å¯Œçš„ä¸»èœå•ï¼š

```
ğŸš€ MaiCore Start ä¸»èœå•
==================================================
[1] éƒ¨ç½²æ–°å®ä¾‹
[2] å¯åŠ¨ç°æœ‰å®ä¾‹  
[3] å®ä¾‹å¤šå¼€ç®¡ç†
[4] é…ç½®ç®¡ç†
[5] ç»„ä»¶ä¸‹è½½
[6] çŸ¥è¯†åº“
[7] å®ä¾‹ç»Ÿè®¡
[8] ç³»ç»Ÿè®¾ç½®
[Q] é€€å‡ºç¨‹åº
```

## âš™ï¸ é…ç½®é›†æœºåˆ¶è¯¦è§£

### ä»€ä¹ˆæ˜¯é…ç½®é›†ï¼Ÿ

é…ç½®é›†æ˜¯ MaiCore Start çš„<mark>æ ¸å¿ƒåˆ›æ–°æœºåˆ¶</mark>ï¼Œå®ƒå°†æ¯ä¸ª Bot å®ä¾‹çš„æ‰€æœ‰é…ç½®ä¿¡æ¯å°è£…ä¸ºä¸€ä¸ªç‹¬ç«‹çš„é…ç½®å•å…ƒã€‚

::: info é…ç½®é›†ç‰¹ç‚¹
- **ç‹¬ç«‹æ€§**: æ¯ä¸ªé…ç½®é›†åŒ…å«å®Œæ•´çš„å®ä¾‹ä¿¡æ¯
- **å¯åˆ‡æ¢**: æ”¯æŒåœ¨å¤šä¸ªé…ç½®é›†é—´å¿«é€Ÿåˆ‡æ¢
- **å¯ç®¡ç†**: æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€éªŒè¯é…ç½®é›†
- **å¯æ¢å¤**: æ¸…æ™°çš„å¼•å¯¼æ‚¨é‡æ–°é…ç½®
:::

### é…ç½®é›†ç»“æ„

```toml
# config/config.toml
[configurations.default]
serial_number = "1"          #åºåˆ—å·
absolute_serial_number = 1   #ç»å¯¹åºåˆ—å·
version_path = "0.0.0"       #ç‰ˆæœ¬å·
nickname_path = "é»˜è®¤é…ç½®"    #å®ä¾‹æ˜µç§°
bot_type = "MaiBot"          #å®ä¾‹ç±»å‹
mai_path = ""                #MaiBotçš„ä¸»ç¨‹åºåœ°å€
mofox_path = ""              #MoFox_botçš„ä¸»ç¨‹åºåœ°å€
adapter_path = ""            #é€‚é…å™¨åœ°å€
napcat_path = ""             #NapCatåœ°å€
napcat_version = ""          #NapCatç‰ˆæœ¬
qq_account = ""              #å½“å‰å®ä¾‹çš„QQå·
```

### é…ç½®é›†ç®¡ç†åŠŸèƒ½

#### 1. è‡ªåŠ¨é…ç½®æ£€æµ‹ ğŸ”

ç¨‹åºå…·å¤‡å¼ºå¤§çš„<mark>è‡ªåŠ¨æ£€æµ‹èƒ½åŠ›</mark>ï¼š

- **Botè·¯å¾„æ£€æµ‹**: è‡ªåŠ¨æ‰«ææŒ‡å®šç›®å½•ä¸‹çš„ Bot å®ä¾‹
- **é…ç½®æ–‡ä»¶è§£æ**: è¯»å– `bot_config.toml` é¢„å¡«å……ä¿¡æ¯
- **ç»„ä»¶è·¯å¾„æ£€æµ‹**: è‡ªåŠ¨å‘ç°é€‚é…å™¨ã€NapCatã€WebUI ç­‰ç»„ä»¶
- **ç‰ˆæœ¬è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ« Bot ç‰ˆæœ¬å¹¶æ¨èç›¸åº”é…ç½®

#### 2. é…ç½®éªŒè¯ä¸ä¿®å¤ ğŸ› ï¸

```python
def _validate_and_repair_serials(self) -> bool:
    """éªŒè¯å¹¶ä¿®å¤ç»å¯¹åºåˆ—å·ï¼Œç¡®ä¿å…¶å”¯ä¸€ä¸”å‡åº"""
    repaired = False
    configurations = self.get_all_configurations()
    
    # æ£€æŸ¥æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼ˆé‡å¤æˆ–ä¸è¿ç»­ï¼‰
    serials = [int(cfg.get("absolute_serial_number")) for _, cfg in config_items]
    is_problematic = len(serials) != len(set(serials)) or sorted(serials) != list(range(1, len(serials) + 1))
    
    if is_problematic:
        # æŒ‰åŸå§‹é¡ºåºé‡æ–°åˆ†é…åºåˆ—å·
        for i, (name, config) in enumerate(config_items):
            self.config["configurations"][name]["absolute_serial_number"] = i + 1
```

#### 3. é…ç½®é›†æ“ä½œ ğŸ¯

**åˆ›å»ºé…ç½®é›†**:
- è‡ªåŠ¨åˆ›å»º: æ‰«æç°æœ‰ Bot å®ä¾‹å¹¶åˆ›å»ºé…ç½®
- æ‰‹åŠ¨åˆ›å»º: é€æ­¥è¾“å…¥é…ç½®ä¿¡æ¯
- æ¨¡æ¿åˆ›å»º: åŸºäºç°æœ‰é…ç½®åˆ›å»ºå‰¯æœ¬

**ç¼–è¾‘é…ç½®é›†**:
- è·¯å¾„æ›´æ–°: ä¿®æ”¹ Botã€é€‚é…å™¨ç­‰ç»„ä»¶è·¯å¾„
- é€‰é¡¹è°ƒæ•´: æ›´æ”¹å®‰è£…çš„ç»„ä»¶é€‰é¡¹
- å‚æ•°ä¿®æ”¹: æ›´æ–°ç‰ˆæœ¬ã€æ˜µç§°ã€QQå·ç­‰

## ğŸ“Š è¿›ç¨‹ç›‘æ§æœºåˆ¶è¯¦è§£

### è¿›ç¨‹ç®¡ç†æ¶æ„

MaiCore Start å®ç°äº†<mark>æå…¶å¼ºå¤§çš„è¿›ç¨‹ç›‘æ§æœºåˆ¶</mark>ï¼Œç¡®ä¿æ¯ä¸ªç»„ä»¶éƒ½èƒ½è¢«å¦¥å–„ç®¡ç†ã€‚

::: warning è¿›ç¨‹ç›‘æ§ç‰¹ç‚¹
- **éš”ç¦»æ€§**: æ¯ä¸ªç»„ä»¶åœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­è¿è¡Œ
- **å¯æ§æ€§**: æ”¯æŒå¯åŠ¨ã€åœæ­¢ã€é‡å¯å•ä¸ªè¿›ç¨‹
- **ç›‘æ§æ€§**: å®æ—¶ç›‘æ§è¿›ç¨‹çŠ¶æ€å’Œèµ„æºä½¿ç”¨
- **å®‰å…¨æ€§**: å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹æ ‘ï¼Œé¿å…åƒµå°¸è¿›ç¨‹
:::

### è¿›ç¨‹ç®¡ç†å™¨æ ¸å¿ƒç»„ä»¶

#### 1. _ProcessManager ç±» ğŸ›ï¸

```python
class _ProcessManager:
    """å†…éƒ¨è¿›ç¨‹ç®¡ç†å™¨ã€‚
    è´Ÿè´£åœ¨æ–°CMDçª—å£ä¸­å¯åŠ¨ã€è·Ÿè¸ªå’Œåœæ­¢è¿›ç¨‹ã€‚
    """
    def __init__(self):
        self.running_processes: List[Dict[str, Any]] = []
```

**æ ¸å¿ƒåŠŸèƒ½**:
- **è¿›ç¨‹å¯åŠ¨**: åœ¨æ–°æ§åˆ¶å°çª—å£ä¸­å¯åŠ¨ç»„ä»¶
- **è¿›ç¨‹è·Ÿè¸ª**: ç»´æŠ¤è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯åˆ—è¡¨
- **è¿›ç¨‹åœæ­¢**: å®‰å…¨ç»ˆæ­¢è¿›ç¨‹åŠå…¶å­è¿›ç¨‹
- **èµ„æºç›‘æ§**: ç›‘æ§ CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ

#### 2. ç»„ä»¶å¯åŠ¨æœºåˆ¶ ğŸ”§

æ¯ä¸ªç»„ä»¶éƒ½ç»§æ‰¿è‡ª `_LaunchComponent` åŸºç±»ï¼š

```python
class _LaunchComponent:
    """å¯å¯åŠ¨ç»„ä»¶çš„åŸºç±»ã€‚"""
    def __init__(self, name: str, config: Dict[str, Any]):
        self.name = name
        self.config = config
        self.is_enabled = False

    def check_enabled(self):
        """æ£€æŸ¥è¯¥ç»„ä»¶æ˜¯å¦æ ¹æ®é…ç½®å¯ç”¨ã€‚"""
        raise NotImplementedError

    def get_launch_details(self) -> Optional[Tuple[str, str, str]]:
        """è·å–å¯åŠ¨æ‰€éœ€çš„å‘½ä»¤ã€å·¥ä½œç›®å½•å’Œçª—å£æ ‡é¢˜ã€‚"""
        raise NotImplementedError
```

**æ”¯æŒçš„ç»„ä»¶ç±»å‹**:
- **MongoDBç»„ä»¶**: ç®¡ç†æ•°æ®åº“æœåŠ¡
- **NapCatç»„ä»¶**: ç®¡ç† QQ åè®®ç«¯
- **é€‚é…å™¨ç»„ä»¶**: ç®¡ç† Bot é€‚é…å™¨
- **WebUIç»„ä»¶**: ç®¡ç†ç½‘é¡µæ§åˆ¶é¢æ¿
- **Maiç»„ä»¶**: ç®¡ç† Bot ä¸»ç¨‹åº

#### 3. æ™ºèƒ½å¯åŠ¨ç­–ç•¥ ğŸ§ 

ç¨‹åºé‡‡ç”¨<mark>æ™ºèƒ½å¯åŠ¨ç­–ç•¥</mark>ï¼Œç¡®ä¿ç»„ä»¶æŒ‰æ­£ç¡®é¡ºåºå¯åŠ¨ï¼š

```python
def launch(self, components_to_start: List[str]) -> bool:
    """æ ¹æ®ç»™å®šçš„ç»„ä»¶åˆ—è¡¨å¯åŠ¨ã€‚"""
    # ç¡®ä¿MongoDBæ€»æ˜¯æœ€å…ˆå¯åŠ¨ï¼Œè™½ç„¶å®ƒæ€»æ˜¯ç”¨ä¸ä¸Š
    if self._components['mongodb'].is_enabled:
        if not self._components['mongodb'].start(self._process_manager):
            ui.print_warning("MongoDBå¯åŠ¨å¤±è´¥ï¼Œä½†å°†ç»§ç»­å°è¯•å¯åŠ¨å…¶ä»–ç»„ä»¶ã€‚")
    
    # æŒ‰é¡ºåºå¯åŠ¨ç»„ä»¶
    launch_order = ["napcat", "webui", "adapter", "mai"]
    final_success = True
    
    for comp_name in launch_order:
        if comp_name in components_to_start:
            if not self._components[comp_name].start(self._process_manager):
                # éº¦éº¦æœ¬ä½“æ˜¯æ ¸å¿ƒï¼Œå¦‚æœå®ƒå¤±è´¥äº†ï¼Œæ•´ä¸ªå¯åŠ¨å°±ç®—å¤±è´¥
                if comp_name == "mai":
                    final_success = False
                    break
```

#### 4. è¿›ç¨‹ç›‘æ§ç•Œé¢ ğŸ“ˆ

ç¨‹åºæä¾›ç›´è§‚çš„è¿›ç¨‹ç›‘æ§ç•Œé¢ï¼š

```
ğŸ“Š è¿›ç¨‹çŠ¶æ€ç®¡ç†
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PID  â”‚ è¿›ç¨‹åç§°            â”‚ CPU %  â”‚ å†…å­˜ (MB)    â”‚ è¿è¡Œæ—¶é—´ (s) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1234 â”‚ éº¦éº¦å¯åŠ¨å™¨          â”‚ 2.15   â”‚ 45.32        â”‚ 3600         â”‚
â”‚ 5678 â”‚ MaiBotä¸»ç¨‹åº        â”‚ 15.67  â”‚ 128.45       â”‚ 3595         â”‚
â”‚ 9012 â”‚ NapCatQQ            â”‚ 8.23   â”‚ 89.12        â”‚ 3590         â”‚
â”‚ 3456 â”‚ é€‚é…å™¨              â”‚ 3.45   â”‚ 56.78        â”‚ 3585         â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿›ç¨‹å®‰å…¨æœºåˆ¶

#### 1. å¼ºåˆ¶è¿›ç¨‹ç»ˆæ­¢ âš¡

```python
def stop_process(self, pid: int) -> bool:
    """é€šè¿‡PIDåœæ­¢å•ä¸ªè¿›ç¨‹åŠå…¶å­è¿›ç¨‹ã€‚"""
    # ä¼˜å…ˆä½¿ç”¨ taskkill (ä»…é™Windows) æ¥ç¡®ä¿ç»ˆæ­¢æ•´ä¸ªè¿›ç¨‹æ ‘
    if os.name == 'nt':
        kill_command = ["taskkill", "/F", "/T", "/PID", str(pid)]
        result = subprocess.run(
            kill_command,
            capture_output=True,
            text=True,
            check=False,
            creationflags=subprocess.CREATE_NO_WINDOW
        )
```

#### 2. è¿›ç¨‹çŠ¶æ€ç¼“å­˜ ğŸ”„

```python
def show_running_processes(self):
    """ä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜è®¡ç®—CPUã€‚"""
    # æ¸…ç†å·²ç»“æŸè¿›ç¨‹çš„ç¼“å­˜
    for pid in list(self._process_cache.keys()):
        if pid not in current_pids:
            del self._process_cache[pid]
    
    # ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤åˆ›å»º Process å¯¹è±¡
    for meta in all_process_meta:
        p = self._process_cache.get(pid)
        if p is None:
            p = psutil.Process(pid)
            p.cpu_percent()  # ç¬¬ä¸€æ¬¡è°ƒç”¨è¿”å›0ï¼Œä½†ä¼šåˆå§‹åŒ–è®¡æ—¶å™¨
            self._process_cache[pid] = p
```

---

## ğŸ”€ å®ä¾‹å¤šå¼€æœºåˆ¶è¯¦è§£

### å¤šå¼€æœºåˆ¶æ¦‚è¿°

å®ä¾‹å¤šå¼€æ˜¯ MaiCore Start çš„<mark>é©å‘½æ€§åŠŸèƒ½</mark>ï¼Œå…è®¸ç”¨æˆ·åŒæ—¶è¿è¡Œå¤šä¸ª Bot å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰ç‹¬ç«‹çš„é…ç½®å’Œç«¯å£ã€‚

::: tip å¤šå¼€ä¼˜åŠ¿
- **èµ„æºéš”ç¦»**: æ¯ä¸ªå®ä¾‹ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å¹²æ‰°
- **ç«¯å£è‡ªåŠ¨åˆ†é…**: æ™ºèƒ½é¿å…ç«¯å£å†²çª
- **ç»Ÿä¸€ç®¡ç†**: é€šè¿‡ç»Ÿä¸€ç•Œé¢ç®¡ç†æ‰€æœ‰å®ä¾‹
- **çµæ´»é…ç½®**: æ¯ä¸ªå®ä¾‹å¯ä½¿ç”¨ä¸åŒé…ç½®
:::

### å¤šå¼€æ¶æ„è®¾è®¡

#### 1. å®ä¾‹æ ‡è¯†ç³»ç»Ÿ ğŸ·ï¸

```python
def create_multi_instance(self, base_config: Dict[str, Any], instance_name: Optional[str] = None) -> str:
    """åˆ›å»ºå¤šå¼€å®ä¾‹"""
    # ç”Ÿæˆå®ä¾‹ID
    instance_id = str(uuid.uuid4())[:8]
    if not instance_name:
        instance_name = f"å¤šå¼€å®ä¾‹_{instance_id}"
    
    # åˆ›å»ºå¤šå¼€å®ä¾‹é…ç½®
    multi_instance = {
        "id": instance_id,
        "name": instance_name,
        "bot_type": bot_type,
        "base_config_name": self._get_config_name_from_config(base_config),
        "created_time": str(Path().cwd()),
        "status": "created",  # created, running, stopped
        "ports": {
            "main_port": main_port,
            "secondary_port": secondary_port
        }
    }
```

**å®ä¾‹å±æ€§**:
- **ID**: 8ä½å”¯ä¸€æ ‡è¯†ç¬¦
- **åç§°**: ç”¨æˆ·å‹å¥½çš„å®ä¾‹åç§°
- **ç±»å‹**: MaiBot æˆ– MoFox_bot
- **çŠ¶æ€**: created/running/stopped
- **ç«¯å£**: ä¸»ç¨‹åºç«¯å£å’Œè¾…åŠ©ç«¯å£

#### 2. ç«¯å£æ™ºèƒ½åˆ†é… ğŸ¯

ç«¯å£ç®¡ç†å™¨é‡‡ç”¨<mark>æ™ºèƒ½åˆ†é…ç®—æ³•</mark>ï¼š

```python
def get_next_instance_port(self, instance_type: str, base_config: Dict) -> Tuple[int, int]:
    """ä¸ºæ–°å®ä¾‹è·å–ä¸‹ä¸€ä¸ªå¯ç”¨ç«¯å£ç»„åˆï¼Œæ”¯æŒå¤šå®ä¾‹æ··ç”¨"""
    if instance_type == "MaiBot":
        # MaiBotéœ€è¦ä¸»ç¨‹åºç«¯å£å’ŒWebUIç«¯å£
        try:
            main_port = self.find_available_port("mai_main")
        except:
            main_port = self.find_available_port("mofox_main")  # æ‰©å±•æœç´¢
        
        try:
            webui_port = self.find_available_port("mai_webui", main_port + 1)
        except:
            webui_port = self.find_available_port("webui", main_port + 1)
            
        return main_port, webui_port
```

**ç«¯å£åˆ†é…ç­–ç•¥**:
- **MaiBot**: ä¸»ç¨‹åº(8000-8100) + WebUI(8001-8101)
- **MoFox_bot**: ä¸»ç¨‹åº(8000-8100) + NapCat(8090-8190)
- **å†²çªæ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å¹¶é¿å…ç«¯å£å†²çª
- **èŒƒå›´æ‰©å±•**: ä¸»èŒƒå›´å†²çªæ—¶è‡ªåŠ¨æ‰©å±•åˆ°å¤‡ç”¨èŒƒå›´

#### 3. é…ç½®ç»§æ‰¿æœºåˆ¶ ğŸ”—

å¤šå¼€å®ä¾‹åŸºäºåŸºç¡€é…ç½®åˆ›å»ºï¼Œä½†ä¼šè¿›è¡Œä¸ªæ€§åŒ–è°ƒæ•´ï¼š

```python
def _get_base_config_for_instance(self, instance: Dict[str, Any]) -> Dict[str, Any]:
    """ä¸ºå¤šå¼€å®ä¾‹è·å–åŸºç¡€é…ç½®"""
    # è·å–åŸºç¡€é…ç½®
    config_name = instance.get("base_config_name", "")
    base_config = all_configs.get(config_name, {})
    
    # æ›´æ–°ç«¯å£ä¿¡æ¯
    ports = instance.get("ports", {})
    main_port = ports.get("main_port")
    secondary_port = ports.get("secondary_port")
    
    if main_port:
        # æ›´æ–°.envæ–‡ä»¶
        env_path = os.path.join(instance_path, ".env")
        if instance["bot_type"] == "MaiBot":
            port_manager.update_env_file(env_path, main_port, secondary_port)
        else:
            port_manager.update_env_file(env_path, main_port)
        
        # æ›´æ–°é€‚é…å™¨é…ç½®
        adapter_path = base_config.get("adapter_path", "")
        if adapter_path and os.path.exists(adapter_path):
            if instance["bot_type"] == "MaiBot":
                adapter_config_path = os.path.join(adapter_path, "config.toml")
                port_manager.update_maibot_adapter_config(adapter_config_path, main_port, secondary_port)
```

### å¤šå¼€ç®¡ç†ç•Œé¢

#### 1. å®ä¾‹åˆ—è¡¨æ˜¾ç¤º ğŸ“‹

```
ğŸš€ å®ä¾‹å¤šå¼€ç®¡ç†
==================================================
[ç«¯å£ä½¿ç”¨çŠ¶æ€]
  MaiBotå®ä¾‹:
    - æˆ‘çš„éº¦éº¦1: ä¸»ç¨‹åº(8000) + WebUI(8001)
    - æˆ‘çš„éº¦éº¦2: ä¸»ç¨‹åº(8002) + WebUI(8003)
  MoFox_botå®ä¾‹:
    - å¢¨ç‹æµ‹è¯•: ä¸»ç¨‹åº(8004) + NapCat(8090)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID     â”‚ åç§°         â”‚ ç±»å‹     â”‚ çŠ¶æ€     â”‚ ç«¯å£     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ a1b2c3d4â”‚ æˆ‘çš„éº¦éº¦1    â”‚ MaiBot   â”‚ running  â”‚ 8000/8001â”‚
â”‚ e5f6g7h8â”‚ æˆ‘çš„éº¦éº¦2    â”‚ MaiBot   â”‚ stopped  â”‚ 8002/8003â”‚
â”‚ i9j0k1l2â”‚ å¢¨ç‹æµ‹è¯•     â”‚ MoFox_botâ”‚ running  â”‚ 8004/8090â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[æ“ä½œé€‰é¡¹]
 [A] åˆ›å»ºæ–°çš„å¤šå¼€å®ä¾‹
 [B] å¯åŠ¨å¤šå¼€å®ä¾‹
 [C] åœæ­¢å¤šå¼€å®ä¾‹
 [D] åˆ é™¤å¤šå¼€å®ä¾‹
 [E] æŸ¥çœ‹å®ä¾‹è¯¦æƒ…
 [Q] è¿”å›ä¸Šçº§èœå•
```

#### 2. å®ä¾‹æ“ä½œåŠŸèƒ½ âš¡

**åˆ›å»ºå®ä¾‹**:
1. é€‰æ‹©åŸºç¡€é…ç½®
2. è¾“å…¥å®ä¾‹åç§°
3. è‡ªåŠ¨åˆ†é…ç«¯å£
4. åˆ›å»ºå®ä¾‹é…ç½®

**å¯åŠ¨å®ä¾‹**:
1. éªŒè¯å®ä¾‹é…ç½®
2. åˆ†é…å¯ç”¨ç«¯å£
3. æ›´æ–°é…ç½®æ–‡ä»¶
4. å¯åŠ¨ç»„ä»¶æœåŠ¡

**åœæ­¢å®ä¾‹**:
1. åœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
2. é‡Šæ”¾ç«¯å£å ç”¨
3. æ›´æ–°å®ä¾‹çŠ¶æ€

**åˆ é™¤å®ä¾‹**:
1. ç¡®è®¤å®ä¾‹çŠ¶æ€
2. åœæ­¢è¿è¡Œä¸­çš„å®ä¾‹
3. åˆ é™¤å®ä¾‹é…ç½®
4. æ¸…ç†ç«¯å£ä¿¡æ¯

---

## ğŸ® å¯åŠ¨æ“ä½œæŒ‡å—

### å¿«é€Ÿå¯åŠ¨æµç¨‹

#### 1. é€‰æ‹©å¯åŠ¨æ–¹å¼ ğŸš€

```
ğŸš€ å¯åŠ¨é€‰æ‹©èœå•
==================================================
å®ä¾‹ç‰ˆæœ¬: 0.10.5
å®ä¾‹æ˜µç§°: æˆ‘çš„éº¦éº¦
Bot ç±»å‹: MaiBot

[å¯ç”¨ç»„ä»¶]
  â€¢ é€‚é…å™¨: âœ… å¯ç”¨
  â€¢ NapCatQQ: âœ… å¯ç”¨
  â€¢ æ£€æŸ¥MongoDB: âŒ æœªé…ç½®
  â€¢ æ§åˆ¶é¢æ¿: âœ… å¯ç”¨
  â€¢ éº¦éº¦æœ¬ä½“: âœ… å¯ç”¨

[é¢„è®¾å¯åŠ¨é¡¹]
 [1] ä¸»ç¨‹åº+é€‚é…å™¨
 [2] ä¸»ç¨‹åº+é€‚é…å™¨+NapCatQQ
 [3] ä¸»ç¨‹åº+é€‚é…å™¨+æ£€æŸ¥MongoDB
 [4] ä¸»ç¨‹åº+é€‚é…å™¨+NapCatQQ+æ£€æŸ¥MongoDB
 [5] ä¸»ç¨‹åº+é€‚é…å™¨+æ§åˆ¶é¢æ¿
 [6] ä¸»ç¨‹åº+é€‚é…å™¨+NapCat+æ§åˆ¶é¢æ¿

 [H] é«˜çº§å¯åŠ¨é¡¹
 [Q] è¿”å›
```

#### 2. é«˜çº§å¯åŠ¨é€‰é¡¹ ğŸ› ï¸

é«˜çº§å¯åŠ¨æ”¯æŒ<mark>å¤šé€‰ç»„ä»¶</mark>ï¼š

```
ğŸ› ï¸ é«˜çº§å¯åŠ¨é¡¹
==================================================
å¯å¤šé€‰ï¼Œè¯·ä½¿ç”¨è‹±æ–‡é€—å·','åˆ†éš”é€‰é¡¹ï¼ˆä¾‹å¦‚: 1,3ï¼‰

 [1] ä¸»ç¨‹åº - âœ… å¯ç”¨
 [2] é€‚é…å™¨ - âœ… å¯ç”¨
 [3] NapCatQQ - âœ… å¯ç”¨
 [4] æ£€æŸ¥MongoDB - âŒ æœªé…ç½®
 [5] æ§åˆ¶é¢æ¿ - âœ… å¯ç”¨

 [Q] è¿”å›

è¯·é€‰æ‹©è¦å¯åŠ¨çš„ç»„ä»¶: 1,2,5
```

### å¯åŠ¨æµç¨‹è¯¦è§£

#### 1. é…ç½®éªŒè¯ âœ…

```python
def validate_configuration(self, config: Dict[str, Any]) -> list:
    """éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§ã€‚"""
    errors = []
    
    # éªŒè¯Botè·¯å¾„
    bot_type = config.get("bot_type", "MaiBot")
    if bot_type == "MoFox_bot":
        mai_path = config.get("mofox_path", "")
    else:
        mai_path = config.get("mai_path", "")
    
    valid, msg = validate_path(mai_path, check_file="bot.py")
    if not valid:
        errors.append(f"éº¦éº¦æœ¬ä½“è·¯å¾„: {msg}")

    # éªŒè¯é€‚é…å™¨è·¯å¾„
    if self._components['adapter'].is_enabled:
        adapter_path = config.get("adapter_path", "")
        valid, msg = validate_path(adapter_path, check_file="main.py")
        if not valid:
            errors.append(f"é€‚é…å™¨è·¯å¾„: {msg}")

    # éªŒè¯NapCatè·¯å¾„
    if self._components['napcat'].is_enabled:
        napcat_path = config.get("napcat_path", "")
        if not (napcat_path and os.path.exists(napcat_path) and napcat_path.lower().endswith('.exe')):
            errors.append("NapCatè·¯å¾„: æ— æ•ˆæˆ–æ–‡ä»¶ä¸å­˜åœ¨ã€‚")
    
    return errors
```

#### 2. ç»„ä»¶å¯åŠ¨é¡ºåº ğŸ“‹

**æ ‡å‡†å¯åŠ¨é¡ºåº**:
1. **MongoDB** (å¦‚æœå¯ç”¨) - æ•°æ®åº“æœåŠ¡
2. **NapCat** - QQ åè®®ç«¯
3. **WebUI** - ç½‘é¡µæ§åˆ¶é¢æ¿
4. **é€‚é…å™¨** - Bot é€‚é…å™¨
5. **MaiBot/MoFox_bot** - Bot ä¸»ç¨‹åº

**å¯åŠ¨é€»è¾‘**:
- MongoDB ä¼˜å…ˆå¯åŠ¨ï¼Œç¡®ä¿æ•°æ®åº“å¯ç”¨
- NapCat åœ¨é€‚é…å™¨å‰å¯åŠ¨ï¼Œç¡®ä¿ QQ è¿æ¥å°±ç»ª
- WebUI ç‹¬ç«‹å¯åŠ¨ï¼Œä¸ä¾èµ–å…¶ä»–ç»„ä»¶
- é€‚é…å™¨è¿æ¥ Bot å’Œ NapCat
- Bot ä¸»ç¨‹åºæœ€åå¯åŠ¨ï¼Œåè°ƒæ‰€æœ‰ç»„ä»¶

#### 3. å¯åŠ¨æˆåŠŸç¡®è®¤ âœ…

```
ğŸ‰ å¯åŠ¨æµç¨‹å®Œæˆï¼
==================================================
âœ… MongoDBæœåŠ¡å·²å¯åŠ¨
âœ… NapCatQQå·²å¯åŠ¨ (PID: 1234)
âœ… æ§åˆ¶é¢æ¿å·²å¯åŠ¨ (http://localhost:7999)
âœ… é€‚é…å™¨å·²å¯åŠ¨ (PID: 5678)
âœ… éº¦éº¦æœ¬ä½“å·²å¯åŠ¨ (PID: 9012)

ğŸŒ è®¿é—®åœ°å€:
   â€¢ Botä¸»ç¨‹åº: http://localhost:8000
   â€¢ æ§åˆ¶é¢æ¿: http://localhost:7999

ğŸ“± è¿›ç¨‹ç›‘æ§:
   ä½¿ç”¨ [è¿›ç¨‹ç®¡ç†] åŠŸèƒ½æŸ¥çœ‹å®æ—¶çŠ¶æ€
```


## ğŸ”§ é«˜çº§åŠŸèƒ½ä½¿ç”¨

### è¿›ç¨‹ç®¡ç†åŠŸèƒ½

#### 1. è¿›ç¨‹çŠ¶æ€ç›‘æ§ ğŸ“Š

ç¨‹åºæä¾›<mark>å®æ—¶è¿›ç¨‹ç›‘æ§</mark>ï¼š

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¯ç”¨å‘½ä»¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ stop <PID>       ç»ˆæ­¢æŒ‡å®šPIDçš„è¿›ç¨‹                                                                                   â”‚
â”‚ restart <PID>    é‡å¯æŒ‡å®šPIDçš„è¿›ç¨‹                                                                                   â”‚
â”‚ details <PID>    æŸ¥çœ‹æŒ‡å®šPIDçš„è¿›ç¨‹è¯¦æƒ…                                                                               â”‚
â”‚ stopall          ç»ˆæ­¢æ‰€æœ‰å—ç®¡è¿›ç¨‹                                                                                    â”‚
â”‚ q / quit         é€€å‡ºçŠ¶æ€ç›‘æ§                                                                                        â”‚
â”‚ Tabé”®            è¡¥å…¨æŒ‡ä»¤æˆ–PID                                                                                       â”‚
â”‚                                                                                                                      â”‚
â”‚                                                                                                                      â”‚
â”‚                                                                                                                      â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                            [ğŸ“Š è¿›ç¨‹çŠ¶æ€ç®¡ç†]
â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ PID      â”ƒ è¿›ç¨‹åç§°                â”ƒ CPU % â”ƒ å†…å­˜ (MB) â”ƒ è¿è¡Œæ—¶é—´ (s) â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ 23936    â”‚ éº¦éº¦å¯åŠ¨å™¨ (ä¸»ç¨‹åº)     â”‚  7.70 â”‚     60.71 â”‚          218 â”‚
â”‚ 22420    â”‚ MaiBot æ§åˆ¶é¢æ¿ - main  â”‚  0.00 â”‚      7.45 â”‚           60 â”‚
â”‚ 25872    â”‚ maimai - é€‚é…å™¨ vmain   â”‚  0.00 â”‚      5.58 â”‚           60 â”‚
â”‚ 12332    â”‚ maimai - éº¦éº¦æœ¬ä½“ vmain â”‚  0.00 â”‚      5.59 â”‚           58 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¾“å…¥å‘½ä»¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ > _                                                                                                                  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯


```

#### 2. è¿›ç¨‹æ“ä½œ âš¡

**é‡å¯è¿›ç¨‹`restart <PID>`**:
- åœæ­¢ç°æœ‰è¿›ç¨‹
- ç­‰å¾…ç«¯å£é‡Šæ”¾
- é‡æ–°å¯åŠ¨è¿›ç¨‹
- ç¡®è®¤å¯åŠ¨çŠ¶æ€

**åœæ­¢è¿›ç¨‹`stop <PID>` or `stopall`**:
- å‘é€ç»ˆæ­¢ä¿¡å·
- å¼ºåˆ¶ç»“æŸè¿›ç¨‹æ ‘
- æ¸…ç†è¿›ç¨‹ç¼“å­˜
- æ›´æ–°çŠ¶æ€æ˜¾ç¤º

**æŸ¥çœ‹è¯¦æƒ…`details <PID>`**:
- è¿›ç¨‹åŸºæœ¬ä¿¡æ¯
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- å¯åŠ¨æ—¶é—´
- å‘½ä»¤è¡Œå‚æ•°
- å·¥ä½œç›®å½•

### é…ç½®ç®¡ç†åŠŸèƒ½

#### 1. é…ç½®é›†æ“ä½œ ğŸ¯

**åˆ›å»ºé…ç½®é›†**:
- è‡ªåŠ¨æ£€æµ‹ç°æœ‰ Bot
- æ‰‹åŠ¨è¾“å…¥é…ç½®ä¿¡æ¯
- éªŒè¯é…ç½®æœ‰æ•ˆæ€§
- ä¿å­˜é…ç½®é›†

**ç¼–è¾‘é…ç½®é›†**:
- ä¿®æ”¹è·¯å¾„ä¿¡æ¯
- è°ƒæ•´ç»„ä»¶é€‰é¡¹
- æ›´æ–°åŸºæœ¬å‚æ•°
- é‡æ–°éªŒè¯é…ç½®

**é…ç½®é›†åˆ‡æ¢**:
- åºåˆ—å·é€‰æ‹©
- åˆ—è¡¨é€‰æ‹©
- é»˜è®¤è®¾ç½®

#### 2. é…ç½®éªŒè¯ä¸ä¿®å¤ ğŸ”§

ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤é…ç½®é—®é¢˜ï¼š

- **è·¯å¾„éªŒè¯**: æ£€æŸ¥æ‰€æœ‰è·¯å¾„æ˜¯å¦æœ‰æ•ˆ
- **æ–‡ä»¶æ£€æŸ¥**: ç¡®è®¤å¿…éœ€æ–‡ä»¶å­˜åœ¨
- **ç‰ˆæœ¬å…¼å®¹**: éªŒè¯ç‰ˆæœ¬ä¸ç»„ä»¶å…¼å®¹æ€§
- **åºåˆ—å·ä¿®å¤**: è‡ªåŠ¨ä¿®å¤é‡å¤æˆ–é”™è¯¯çš„åºåˆ—å·

### å¤šå¼€å®ä¾‹é«˜çº§åŠŸèƒ½

#### 1. æ‰¹é‡æ“ä½œ ğŸ“¦

**æ‰¹é‡å¯åŠ¨**:
- é€‰æ‹©å¤šä¸ªå®ä¾‹
- ä¾æ¬¡å¯åŠ¨æ¯ä¸ªå®ä¾‹
- æ˜¾ç¤ºå¯åŠ¨ç»“æœ
- ç›‘æ§è¿è¡ŒçŠ¶æ€

**æ‰¹é‡åœæ­¢**:
- åœæ­¢æ‰€æœ‰è¿è¡Œå®ä¾‹
- é‡Šæ”¾æ‰€æœ‰å ç”¨ç«¯å£
- æ›´æ–°å®ä¾‹çŠ¶æ€

**æ‰¹é‡åˆ é™¤**:
- ç¡®è®¤åˆ é™¤æ“ä½œ
- åœæ­¢è¿è¡Œä¸­çš„å®ä¾‹
- åˆ é™¤å®ä¾‹é…ç½®
- æ¸…ç†ç›¸å…³æ–‡ä»¶

#### 2. å®ä¾‹æ¨¡æ¿ ğŸ“‹

åˆ›å»ºå®ä¾‹æ¨¡æ¿ä»¥å¿«é€Ÿéƒ¨ç½²ï¼š

```python
# åŸºäºç°æœ‰å®ä¾‹åˆ›å»ºæ¨¡æ¿
def create_instance_template(self, instance_id: str, template_name: str) -> bool:
    """åˆ›å»ºå®ä¾‹æ¨¡æ¿"""
    instance = self.get_multi_instance(instance_id)
    if not instance:
        return False
    
    template = {
        "name": template_name,
        "bot_type": instance["bot_type"],
        "base_config_name": instance["base_config_name"],
        "install_options": instance.get("install_options", {}),
        "is_template": True
    }
    
    # ä¿å­˜æ¨¡æ¿
    templates = self.config.get("instance_templates", {})
    templates[template_name] = template
    self.config.set("instance_templates", templates)
    self.config.save()
    
    return True
```


## â“ æ•…éšœæ’é™¤

### å¸¸è§å¯åŠ¨é—®é¢˜

#### 1. é…ç½®éªŒè¯å¤±è´¥ âŒ

**é—®é¢˜**: é…ç½®éªŒè¯æ˜¾ç¤ºé”™è¯¯

```
âŒ é…ç½®éªŒè¯å¤±è´¥ï¼š
  â€¢ éº¦éº¦æœ¬ä½“è·¯å¾„: è·¯å¾„ä¸å­˜åœ¨æˆ–ç¼ºå°‘bot.pyæ–‡ä»¶
  â€¢ é€‚é…å™¨è·¯å¾„: è·¯å¾„ä¸å­˜åœ¨æˆ–ç¼ºå°‘main.pyæ–‡ä»¶
  â€¢ NapCatè·¯å¾„: æ— æ•ˆæˆ–æ–‡ä»¶ä¸å­˜åœ¨
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥è·¯å¾„**: ç¡®è®¤æ‰€æœ‰è·¯å¾„æ­£ç¡®ä¸”æ–‡ä»¶å­˜åœ¨
2. **é‡æ–°é…ç½®**: ä½¿ç”¨é…ç½®ç®¡ç†åŠŸèƒ½æ›´æ–°è·¯å¾„
3. **é‡æ–°éƒ¨ç½²**: å¦‚æœè·¯å¾„ç¡®å®æ”¹å˜ï¼Œé‡æ–°éƒ¨ç½²å®ä¾‹

#### 2. ç«¯å£å†²çª ğŸš«

**é—®é¢˜**: ç«¯å£è¢«å ç”¨

```
âŒ ç«¯å£ 8000 å·²è¢«å ç”¨
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥å ç”¨è¿›ç¨‹**: ä½¿ç”¨ `netstat -ano | findstr :8000`
2. **åœæ­¢å†²çªè¿›ç¨‹**: ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹
3. **ä½¿ç”¨å¤šå¼€åŠŸèƒ½**: åˆ›å»ºæ–°å®ä¾‹è‡ªåŠ¨åˆ†é…å…¶ä»–ç«¯å£

#### 3. ç»„ä»¶å¯åŠ¨å¤±è´¥ âš ï¸

**é—®é¢˜**: æŸä¸ªç»„ä»¶å¯åŠ¨å¤±è´¥

```
âš ï¸ é€‚é…å™¨å¯åŠ¨å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥ä¾èµ–**: ç¡®è®¤ Python ç¯å¢ƒå’Œä¾èµ–åŒ…
2. **æ£€æŸ¥é…ç½®**: éªŒè¯é…ç½®æ–‡ä»¶æ­£ç¡®æ€§
3. **æŸ¥çœ‹æ—¥å¿—**: æ£€æŸ¥ç»„ä»¶æ—¥å¿—æ–‡ä»¶
4. **é‡æ–°å®‰è£…**: å¿…è¦æ—¶é‡æ–°å®‰è£…ç»„ä»¶

#### 4. è¿›ç¨‹ç®¡ç†é—®é¢˜ ğŸ”„

**é—®é¢˜**: è¿›ç¨‹æ— æ³•åœæ­¢

```
âŒ åœæ­¢è¿›ç¨‹å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ**:
1. **ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨**: æ‰‹åŠ¨ç»“æŸè¿›ç¨‹
2. **é‡å¯ç¨‹åº**: é‡å¯ MaiCore Start
3. **å¼ºåˆ¶ç»ˆæ­¢**: ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨å¼ºåˆ¶ç»“æŸ

### é«˜çº§æ•…éšœæ’é™¤

#### 1. é…ç½®æ–‡ä»¶æŸå ğŸ—‚ï¸

**æ£€æµ‹**: ç¨‹åºå¯åŠ¨æ—¶æç¤ºé…ç½®æŸå

**ä¿®å¤**: 
```python
# ç¨‹åºä¼šè‡ªåŠ¨ä¿®å¤æŸåçš„é…ç½®
def _validate_and_repair_serials(self) -> bool:
    """éªŒè¯å¹¶ä¿®å¤ç»å¯¹åºåˆ—å·"""
    repaired = False
    # é‡æ–°åˆ†é…åºåˆ—å·
    for i, (name, config) in enumerate(config_items):
        self.config["configurations"][name]["absolute_serial_number"] = i + 1
    return repaired
```

#### 2. ç«¯å£ç®¡ç†å™¨å¼‚å¸¸ ğŸ”Œ

**æ£€æµ‹**: ç«¯å£åˆ†é…å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. **é‡å¯ç«¯å£ç®¡ç†å™¨**: é‡å¯ç¨‹åºé‡ç½®ç«¯å£çŠ¶æ€
2. **æ‰‹åŠ¨é‡Šæ”¾ç«¯å£**: ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹
3. **æ‰©å±•ç«¯å£èŒƒå›´**: ä¿®æ”¹ç«¯å£èŒƒå›´é…ç½®

#### 3. å¤šå¼€å®ä¾‹å†²çª ğŸ”€

**æ£€æµ‹**: å¤šå¼€å®ä¾‹æ— æ³•å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥ç«¯å£åˆ†é…**: ç¡®è®¤ç«¯å£åˆ†é…æ­£ç¡®
2. **éªŒè¯é…ç½®ç»§æ‰¿**: æ£€æŸ¥åŸºç¡€é…ç½®æ˜¯å¦æœ‰æ•ˆ
3. **æ¸…ç†å®ä¾‹çŠ¶æ€**: åˆ é™¤å¹¶é‡æ–°åˆ›å»ºå®ä¾‹


## ğŸ“ è·å–å¸®åŠ©

### å®˜æ–¹èµ„æº

<NCard title="MaiBot Docs" link="https://docs.mai-mai.org">
MaiBot å®˜æ–¹æ–‡æ¡£ä¸­å¿ƒ
</NCard>

<NCard title="MoFox_bot Docs" link="https://docs.mofox-sama.com/">
MoFox_bot å®˜æ–¹æ–‡æ¡£ä¸­å¿ƒ
</NCard>

### ç¤¾åŒºæ”¯æŒ

- **QQæŠ€æœ¯ç¾¤**: æœç´¢ç›¸å…³æŠ€æœ¯äº¤æµç¾¤
- **è®ºå›è®¨è®º**: å‚ä¸æŠ€æœ¯è®¨è®ºå’Œç»éªŒåˆ†äº«
- **åœ¨çº¿æ–‡æ¡£**: æŸ¥çœ‹è¯¦ç»†çš„åœ¨çº¿æ–‡æ¡£

### é—®é¢˜åé¦ˆ

å¦‚æœæ‚¨é‡åˆ°å¯åŠ¨é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

- **é”™è¯¯ä¿¡æ¯**: å®Œæ•´çš„é”™è¯¯æç¤º
- **ç³»ç»Ÿç¯å¢ƒ**: Windowsç‰ˆæœ¬ã€Pythonç‰ˆæœ¬ç­‰
- **æ“ä½œæ­¥éª¤**: è¯¦ç»†çš„æ“ä½œè¿‡ç¨‹
- **æ—¥å¿—æ–‡ä»¶**: ç›¸å…³çš„æ—¥å¿—å†…å®¹


## ğŸ“„ æ›´æ–°æ—¥å¿—

### v4.1.2-beta
- âœ¨ å…¨æ–°å¯åŠ¨ç³»ç»Ÿ
- ğŸ”§ ä¼˜åŒ–é…ç½®é›†æœºåˆ¶
- ğŸ“Š å¢å¼ºè¿›ç¨‹ç›‘æ§
- ğŸ”€ å®Œå–„å¤šå¼€åŠŸèƒ½
- ğŸ› ä¿®å¤å·²çŸ¥é—®é¢˜

### v4.1.1
- ğŸš€ æå‡å¯åŠ¨é€Ÿåº¦
- ğŸ’¾ æ”¹è¿›é…ç½®ç®¡ç†
- ğŸ”’ å¢å¼ºç¨³å®šæ€§

---


**æ„Ÿè°¢ä½¿ç”¨ MaiCore Start å¯åŠ¨ç³»ç»Ÿï¼** 

é€šè¿‡é…ç½®é›†æœºåˆ¶ã€è¿›ç¨‹ç›‘æ§æœºåˆ¶å’Œå®ä¾‹å¤šå¼€æœºåˆ¶ï¼Œç¨‹åºä¸ºç”¨æˆ·æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ Bot ç®¡ç†ä½“éªŒã€‚å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªå¯åŠ¨ç³»ç»Ÿæœ‰å¸®åŠ©ï¼Œè¯·ç»™é¡¹ç›®ç‚¹ä¸ªæ˜Ÿâ­ï¼

## [TOP](#ğŸ“‹-ç›®å½•)

<!-- å¯åŠ¨æŒ‡å—ç»“æŸ -->